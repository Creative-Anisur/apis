"use strict";if(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,getTime=Date.now||function(){return(new Date).getTime()},push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.5.2";var each=_.each=_.forEach=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){return iterator.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)},_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){return(result=result&&iterator.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){return result||(result=iterator.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs,first){return _.isEmpty(attrs)?first?void 0:[]:_[first?"find":"filter"](obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return!1;return!0})},_.findWhere=function(obj,attrs){return _.where(obj,attrs,!0)},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-1/0;var result={computed:-1/0,value:-1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return 1/0;var result={computed:1/0,value:1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)};_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);length>idx;)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}},_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:getTime(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=getTime();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this,args=arguments,timestamp=getTime();var later=function(){var last=getTime()-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))},callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),!function(root,String){function boolMatch(s,matchers){var i,matcher,down=s.toLowerCase();for(matchers=[].concat(matchers),i=0;i<matchers.length;i+=1)if(matcher=matchers[i]){if(matcher.test&&matcher.test(s))return!0;if(matcher.toLowerCase()===down)return!0}}var nativeTrim=String.prototype.trim,nativeTrimRight=String.prototype.trimRight,nativeTrimLeft=String.prototype.trimLeft,parseNumber=function(source){return 1*source||0},strRepeat=function(str,qty){if(1>qty)return"";for(var result="";qty>0;)1&qty&&(result+=str),qty>>=1,str+=str;return result},slice=[].slice,defaultToWhiteSpace=function(characters){return null==characters?"\\s":characters.source?characters.source:"["+_s.escapeRegExp(characters)+"]"},escapeChars={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},reversedEscapeChars={};for(var key in escapeChars)reversedEscapeChars[escapeChars[key]]=key;reversedEscapeChars["'"]="#39";var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}var str_repeat=strRepeat,str_format=function(){return str_format.cache.hasOwnProperty(arguments[0])||(str_format.cache[arguments[0]]=str_format.parse(arguments[0])),str_format.format.call(null,str_format.cache[arguments[0]],arguments)};return str_format.format=function(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,cursor=1,tree_length=parse_tree.length,node_type="",output=[];for(i=0;tree_length>i;i++)if(node_type=get_type(parse_tree[i]),"string"===node_type)output.push(parse_tree[i]);else if("array"===node_type){if(match=parse_tree[i],match[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw new Error(sprintf('[_.sprintf] property "%s" does not exist',match[2][k]));arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if(/[^s]/.test(match[8])&&"number"!=get_type(arg))throw new Error(sprintf("[_.sprintf] expecting number but found %s",get_type(arg)));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?"0"==match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}return output.join("")},str_format.cache={},str_format.parse=function(fmt){for(var _fmt=fmt,match=[],parse_tree=[],arg_names=0;_fmt;){if(null!==(match=/^[^\x25]+/.exec(_fmt)))parse_tree.push(match[0]);else if(null!==(match=/^\x25{2}/.exec(_fmt)))parse_tree.push("%");else{if(null===(match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)))throw new Error("[_.sprintf] huh?");if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field)))throw new Error("[_.sprintf] huh?");for(field_list.push(field_match[1]);""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)))field_list.push(field_match[1]);else{if(null===(field_match=/^\[(\d+)\]/.exec(replacement_field)))throw new Error("[_.sprintf] huh?");field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree},str_format}(),_s={VERSION:"2.3.0",isBlank:function(str){return null==str&&(str=""),/^\s*$/.test(str)},stripTags:function(str){return null==str?"":String(str).replace(/<\/?[^>]+>/g,"")},capitalize:function(str){return str=null==str?"":String(str),str.charAt(0).toUpperCase()+str.slice(1)},chop:function(str,step){return null==str?[]:(str=String(str),step=~~step,step>0?str.match(new RegExp(".{1,"+step+"}","g")):[str])},clean:function(str){return _s.strip(str).replace(/\s+/g," ")},count:function(str,substr){if(null==str||null==substr)return 0;str=String(str),substr=String(substr);for(var count=0,pos=0,length=substr.length;;){if(pos=str.indexOf(substr,pos),-1===pos)break;count++,pos+=length}return count},chars:function(str){return null==str?[]:String(str).split("")},swapCase:function(str){return null==str?"":String(str).replace(/\S/g,function(c){return c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()})},escapeHTML:function(str){return null==str?"":String(str).replace(/[&<>"']/g,function(m){return"&"+reversedEscapeChars[m]+";"})},unescapeHTML:function(str){return null==str?"":String(str).replace(/\&([^;]+);/g,function(entity,entityCode){var match;return entityCode in escapeChars?escapeChars[entityCode]:(match=entityCode.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(match[1],16)):(match=entityCode.match(/^#(\d+)$/))?String.fromCharCode(~~match[1]):entity})},escapeRegExp:function(str){return null==str?"":String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(str,i,howmany,substr){var arr=_s.chars(str);return arr.splice(~~i,~~howmany,substr),arr.join("")},insert:function(str,i,substr){return _s.splice(str,i,0,substr)},include:function(str,needle){return""===needle?!0:null==str?!1:-1!==String(str).indexOf(needle)},join:function(){var args=slice.call(arguments),separator=args.shift();return null==separator&&(separator=""),args.join(separator)},lines:function(str){return null==str?[]:String(str).split("\n")},reverse:function(str){return _s.chars(str).reverse().join("")},startsWith:function(str,starts){return""===starts?!0:null==str||null==starts?!1:(str=String(str),starts=String(starts),str.length>=starts.length&&str.slice(0,starts.length)===starts)},endsWith:function(str,ends){return""===ends?!0:null==str||null==ends?!1:(str=String(str),ends=String(ends),str.length>=ends.length&&str.slice(str.length-ends.length)===ends)},succ:function(str){return null==str?"":(str=String(str),str.slice(0,-1)+String.fromCharCode(str.charCodeAt(str.length-1)+1))},titleize:function(str){return null==str?"":(str=String(str).toLowerCase(),str.replace(/(?:^|\s|-)\S/g,function(c){return c.toUpperCase()}))},camelize:function(str){return _s.trim(str).replace(/[-_\s]+(.)?/g,function(match,c){return c?c.toUpperCase():""})},underscored:function(str){return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(str){return _s.trim(str).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(str){return _s.titleize(String(str).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(str){return _s.capitalize(_s.underscored(str).replace(/_id$/,"").replace(/_/g," "))},trim:function(str,characters){return null==str?"":!characters&&nativeTrim?nativeTrim.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp("^"+characters+"+|"+characters+"+$","g"),""))},ltrim:function(str,characters){return null==str?"":!characters&&nativeTrimLeft?nativeTrimLeft.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp("^"+characters+"+"),""))},rtrim:function(str,characters){return null==str?"":!characters&&nativeTrimRight?nativeTrimRight.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp(characters+"+$"),""))},truncate:function(str,length,truncateStr){return null==str?"":(str=String(str),truncateStr=truncateStr||"...",length=~~length,str.length>length?str.slice(0,length)+truncateStr:str)},prune:function(str,length,pruneStr){if(null==str)return"";if(str=String(str),length=~~length,pruneStr=null!=pruneStr?String(pruneStr):"...",str.length<=length)return str;var tmpl=function(c){return c.toUpperCase()!==c.toLowerCase()?"A":" "},template=str.slice(0,length+1).replace(/.(?=\W*\w*$)/g,tmpl);return template=template.slice(template.length-2).match(/\w\w/)?template.replace(/\s*\S+$/,""):_s.rtrim(template.slice(0,template.length-1)),(template+pruneStr).length>str.length?str:str.slice(0,template.length)+pruneStr},words:function(str,delimiter){return _s.isBlank(str)?[]:_s.trim(str,delimiter).split(delimiter||/\s+/)},pad:function(str,length,padStr,type){str=null==str?"":String(str),length=~~length;var padlen=0;switch(padStr?padStr.length>1&&(padStr=padStr.charAt(0)):padStr=" ",type){case"right":return padlen=length-str.length,str+strRepeat(padStr,padlen);case"both":return padlen=length-str.length,strRepeat(padStr,Math.ceil(padlen/2))+str+strRepeat(padStr,Math.floor(padlen/2));default:return padlen=length-str.length,strRepeat(padStr,padlen)+str}},lpad:function(str,length,padStr){return _s.pad(str,length,padStr)},rpad:function(str,length,padStr){return _s.pad(str,length,padStr,"right")},lrpad:function(str,length,padStr){return _s.pad(str,length,padStr,"both")},sprintf:sprintf,vsprintf:function(fmt,argv){return argv.unshift(fmt),sprintf.apply(null,argv)},toNumber:function(str,decimals){return str?(str=_s.trim(str),str.match(/^-?\d+(?:\.\d+)?$/)?parseNumber(parseNumber(str).toFixed(~~decimals)):0/0):0},numberFormat:function(number,dec,dsep,tsep){if(isNaN(number)||null==number)return"";number=number.toFixed(~~dec),tsep="string"==typeof tsep?tsep:",";var parts=number.split("."),fnums=parts[0],decimals=parts[1]?(dsep||".")+parts[1]:"";return fnums.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+tsep)+decimals},strRight:function(str,sep){if(null==str)return"";str=String(str),sep=null!=sep?String(sep):sep;var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str},strRightBack:function(str,sep){if(null==str)return"";str=String(str),sep=null!=sep?String(sep):sep;var pos=sep?str.lastIndexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str},strLeft:function(str,sep){if(null==str)return"";str=String(str),sep=null!=sep?String(sep):sep;var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(0,pos):str},strLeftBack:function(str,sep){if(null==str)return"";str+="",sep=null!=sep?""+sep:sep;var pos=str.lastIndexOf(sep);return~pos?str.slice(0,pos):str},toSentence:function(array,separator,lastSeparator,serial){separator=separator||", ",lastSeparator=lastSeparator||" and ";var a=array.slice(),lastMember=a.pop();return array.length>2&&serial&&(lastSeparator=_s.rtrim(separator)+lastSeparator),a.length?a.join(separator)+lastSeparator+lastMember:lastMember},toSentenceSerial:function(){var args=slice.call(arguments);return args[3]=!0,_s.toSentence.apply(_s,args)},slugify:function(str){if(null==str)return"";var from="ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",to="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",regex=new RegExp(defaultToWhiteSpace(from),"g");return str=String(str).toLowerCase().replace(regex,function(c){var index=from.indexOf(c);return to.charAt(index)||"-"}),_s.dasherize(str.replace(/[^\w\s-]/g,""))},surround:function(str,wrapper){return[wrapper,str,wrapper].join("")},quote:function(str,quoteChar){return _s.surround(str,quoteChar||'"')},unquote:function(str,quoteChar){return quoteChar=quoteChar||'"',str[0]===quoteChar&&str[str.length-1]===quoteChar?str.slice(1,str.length-1):str},exports:function(){var result={};for(var prop in this)this.hasOwnProperty(prop)&&!prop.match(/^(?:include|contains|reverse)$/)&&(result[prop]=this[prop]);
return result},repeat:function(str,qty,separator){if(null==str)return"";if(qty=~~qty,null==separator)return strRepeat(String(str),qty);for(var repeat=[];qty>0;repeat[--qty]=str);return repeat.join(separator)},naturalCmp:function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;for(var cmpRegex=/(\.\d+)|(\d+)|(\D+)/g,tokens1=String(str1).toLowerCase().match(cmpRegex),tokens2=String(str2).toLowerCase().match(cmpRegex),count=Math.min(tokens1.length,tokens2.length),i=0;count>i;i++){var a=tokens1[i],b=tokens2[i];if(a!==b){var num1=parseInt(a,10);if(!isNaN(num1)){var num2=parseInt(b,10);if(!isNaN(num2)&&num1-num2)return num1-num2}return b>a?-1:1}}return tokens1.length===tokens2.length?tokens1.length-tokens2.length:str2>str1?-1:1},levenshtein:function(str1,str2){if(null==str1&&null==str2)return 0;if(null==str1)return String(str2).length;if(null==str2)return String(str1).length;str1=String(str1),str2=String(str2);for(var prev,value,current=[],i=0;i<=str2.length;i++)for(var j=0;j<=str1.length;j++)value=i&&j?str1.charAt(j-1)===str2.charAt(i-1)?prev:Math.min(current[j],current[j-1],prev)+1:i+j,prev=current[j],current[j]=value;return current.pop()},toBoolean:function(str,trueValues,falseValues){return"number"==typeof str&&(str=""+str),"string"!=typeof str?!!str:(str=_s.trim(str),boolMatch(str,trueValues||["true","1"])?!0:boolMatch(str,falseValues||["false","0"])?!1:void 0)}};_s.strip=_s.trim,_s.lstrip=_s.ltrim,_s.rstrip=_s.rtrim,_s.center=_s.lrpad,_s.rjust=_s.lpad,_s.ljust=_s.rpad,_s.contains=_s.include,_s.q=_s.quote,_s.toBool=_s.toBoolean,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(module.exports=_s),exports._s=_s),"function"==typeof define&&define.amd&&define("underscore.string",[],function(){return _s}),root._=root._||{},root._.string=root._.str=_s}(this,String),function(global,GeneratorFunction,undefined){function wrapGenerator(innerFn,outerFn,self,tryList){return new Generator(innerFn,outerFn,self||null,tryList||[])}function Generator(innerFn,outerFn,self,tryList){function invoke(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted)throw new Error("Generator has already finished");for(;;){var delegate=context.delegate;if(delegate){try{var info=delegate.iterator[method](arg);method="next",arg=undefined}catch(uncaught){context.delegate=null,method="throw",arg=uncaught;continue}if(!info.done)return state=GenStateSuspendedYield,info;context[delegate.resultName]=info.value,context.next=delegate.nextLoc,context.delegate=null}if("next"===method){if(state===GenStateSuspendedStart&&"undefined"!=typeof arg)throw new TypeError("attempt to send "+JSON.stringify(arg)+" to newborn generator");state===GenStateSuspendedYield?context.sent=arg:delete context.sent}else if("throw"===method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,arg;context.dispatchException(arg)&&(method="next",arg=undefined)}state=GenStateExecuting;try{var value=innerFn.call(self,context);state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:value,done:context.done};if(value!==ContinueSentinel)return info;context.delegate&&"next"===method&&(arg=undefined)}catch(thrown){state=GenStateCompleted,"next"===method?context.dispatchException(thrown):arg=thrown}}}var generator=outerFn?Object.create(outerFn.prototype):this,context=new Context(tryList),state=GenStateSuspendedStart;return generator.next=invoke.bind(generator,"next"),generator.throw=invoke.bind(generator,"throw"),generator}function pushTryEntry(triple){var entry={tryLoc:triple[0]};1 in triple&&(entry.catchLoc=triple[1]),2 in triple&&(entry.finallyLoc=triple[2]),this.tryEntries.push(entry)}function resetTryEntry(entry,i){var record=entry.completion||{};record.type=0===i?"normal":"return",delete record.arg,entry.completion=record}function Context(tryList){this.tryEntries=[{tryLoc:"root"}],tryList.forEach(pushTryEntry,this),this.reset()}function values(iterable){var iterator=iterable,Symbol=global.Symbol;if(Symbol&&Symbol.iterator in iterable)iterator=iterable[Symbol.iterator]();else if(!isNaN(iterable.length)){var i=-1;iterator=function next(){for(;++i<iterable.length;)if(i in iterable)return next.value=iterable[i],next.done=!1,next;return next.done=!0,next},iterator.next=iterator}return iterator}var hasOwn=Object.prototype.hasOwnProperty;if(!global.wrapGenerator){global.wrapGenerator=wrapGenerator,"undefined"!=typeof exports&&(exports.wrapGenerator=wrapGenerator);var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={},Gp=Generator.prototype,GFp=GeneratorFunction.prototype=Object.create(Function.prototype);GFp.constructor=GeneratorFunction,GFp.prototype=Gp,Gp.constructor=GFp,wrapGenerator.mark=function(genFun){return genFun.__proto__=GFp,genFun.prototype=Object.create(Gp),genFun},"GeneratorFunction"!==GeneratorFunction.name&&(GeneratorFunction.name="GeneratorFunction"),wrapGenerator.isGeneratorFunction=function(genFun){var ctor=genFun&&genFun.constructor;return ctor?GeneratorFunction.name===ctor.name:!1},Generator.prototype.toString=function(){return"[object Generator]"},wrapGenerator.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},wrapGenerator.values=values,Context.prototype={constructor:Context,reset:function(){this.prev=0,this.next=0,this.sent=undefined,this.done=!1,this.delegate=null,this.tryEntries.forEach(resetTryEntry);for(var tempName,tempIndex=0;hasOwn.call(this,tempName="t"+tempIndex)||20>tempIndex;++tempIndex)this[tempName]=null},stop:function(){this.done=!0;var rootEntry=this.tryEntries[0],rootRecord=rootEntry.completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,!!caught}if(this.done)throw exception;for(var context=this,i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},_findFinallyEntry:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&(entry.finallyLoc===finallyLoc||this.prev<entry.finallyLoc))return entry}},abrupt:function(type,arg){var entry=this._findFinallyEntry(),record=entry?entry.completion:{};return record.type=type,record.arg=arg,entry?this.next=entry.finallyLoc:this.complete(record),ContinueSentinel},complete:function(record){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type&&(this.rval=record.arg,this.next="end"),ContinueSentinel},finish:function(finallyLoc){var entry=this._findFinallyEntry(finallyLoc);return this.complete(entry.completion)},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry,i)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},ContinueSentinel}}}}.apply(this,Function("return [this, function GeneratorFunction(){}]")()),"undefined"==typeof net)var net={};net.brehaut||(net.brehaut={});var algo=algo||{};(function(){function pad(val,len){val=val.toString();for(var padded=[],i=0,j=Math.max(len-val.length,0);j>i;i++)padded.push("0");return padded.push(val),padded.join("")}function capitalise(s){return s.slice(0,1).toUpperCase()+s.slice(1)}function trim(str){return str.replace(/^\s+|\s+$/g,"")}function cloneOnApply(meth){return function(){var cloned=this.clone();return meth.apply(cloned,arguments),cloned}}function registerModel(name,model){function convertAndApply(meth){return function(){return meth.apply(this[to_meth](),arguments)}}function F(){}function factory(){return new F}var proto=object(color),fields=[],to_meth="to"+capitalise(name);for(var key in model)if(model.hasOwnProperty(key)){proto[key]=model[key];var prop=proto[key];if("_"==key.slice(0,1))continue;if(key in color||"function"!=typeof prop){if("function"!=typeof prop){fields.push(key);var getter="get"+capitalise(key),setter="set"+capitalise(key);color[getter]=convertAndApply(proto[getter]=function(key){return function(){return this[key]}}(key)),color[setter]=convertAndApply(proto[setter]=function(key){return function(val){var cloned=this.clone();return cloned[key]=val,cloned}}(key))}}else color[key]=convertAndApply(prop)}return F.prototype=proto,factories[name]=factory,proto.clone=function(){for(var cloned=factory(),i=0,j=fields.length;j>i;i++){var key=fields[i];cloned[key]=this[key]}return cloned},color[to_meth]=function(){return factory()},registered_models.push(proto),proto}function Color(o){return color.fromObject(o)}var css_colors={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:'#9ACD32"'},css_integer="(?:\\+|-)?\\d+",css_float="(?:\\+|-)?\\d*\\.\\d+",css_number="(?:"+css_integer+")|(?:"+css_float+")";css_integer="("+css_integer+")",css_float="("+css_float+")",css_number="("+css_number+")";var color,css_percentage=css_number+"%",css_whitespace="\\s*?",hsl_hsla_regex=new RegExp(["^hsl(a?)\\(",css_number,",",css_percentage,",",css_percentage,"(,(",css_number,"))?\\)$"].join(css_whitespace)),rgb_rgba_integer_regex=new RegExp(["^rgb(a?)\\(",css_integer,",",css_integer,",",css_integer,"(,(",css_number,"))?\\)$"].join(css_whitespace)),rgb_rgba_percentage_regex=new RegExp(["^rgb(a?)\\(",css_percentage,",",css_percentage,",",css_percentage,"(,(",css_number,"))?\\)$"].join(css_whitespace)),registered_models=[],factories={};this.object||(this.object=function(o){function F(){}return F.prototype=o,new F});var object=this.object;color={fromObject:function(o){if(!o)return object(color);for(var i=0,j=registered_models.length;j>i;i++){var nu=registered_models[i].fromObject(o);if(nu)return nu}return object(color)},toString:function(){return this.toCSS()}};var transparent=null;registerModel("RGB",{red:0,green:0,blue:0,alpha:0,getLuminance:function(){return.2126*this.red+.7152*this.green+.0722*this.blue},blend:function(color,alpha){color=color.toRGB(),alpha=Math.min(Math.max(alpha,0),1);var rgb=this.clone();return rgb.red=rgb.red*(1-alpha)+color.red*alpha,rgb.green=rgb.green*(1-alpha)+color.green*alpha,rgb.blue=rgb.blue*(1-alpha)+color.blue*alpha,rgb.alpha=rgb.alpha*(1-alpha)+color.alpha*alpha,rgb},fromObject:function(o){return o instanceof Array?this._fromRGBArray(o):"string"==typeof o?this._fromCSS(trim(o)):o.hasOwnProperty("red")&&o.hasOwnProperty("green")&&o.hasOwnProperty("blue")?this._fromRGB(o):void 0},_stringParsers:[function(css){function match(regex,max_value){var colorGroups=css.match(regex);if(!colorGroups||!!colorGroups[1]+!!colorGroups[5]===1)return null;var rgb=factories.RGB();return rgb.red=Math.min(1,Math.max(0,colorGroups[2]/max_value)),rgb.green=Math.min(1,Math.max(0,colorGroups[3]/max_value)),rgb.blue=Math.min(1,Math.max(0,colorGroups[4]/max_value)),rgb.alpha=colorGroups[5]?Math.min(Math.max(parseFloat(colorGroups[6]),0),1):1,rgb}css=trim(css);var withInteger=match(rgb_rgba_integer_regex,255);return withInteger?withInteger:match(rgb_rgba_percentage_regex,100)},function(css){var lower=css.toLowerCase();if(lower in css_colors&&(css=css_colors[lower]),css.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)){css=css.replace(/^#/,"");var bytes=css.length/3,max=Math.pow(16,bytes)-1,rgb=factories.RGB();return rgb.red=parseInt(css.slice(0,bytes),16)/max,rgb.green=parseInt(css.slice(1*bytes,2*bytes),16)/max,rgb.blue=parseInt(css.slice(2*bytes),16)/max,rgb.alpha=1,rgb}},function(css){return"transparent"===css.toLowerCase()?transparent:void 0}],_fromCSS:function(css){for(var color=null,i=0,j=this._stringParsers.length;j>i;i++)if(color=this._stringParsers[i](css))return color},_fromRGB:function(RGB){var newRGB=factories.RGB();return newRGB.red=RGB.red,newRGB.green=RGB.green,newRGB.blue=RGB.blue,newRGB.alpha=RGB.hasOwnProperty("alpha")?RGB.alpha:1,newRGB},_fromRGBArray:function(RGB){var newRGB=factories.RGB();return newRGB.red=Math.max(0,Math.min(1,RGB[0]/255)),newRGB.green=Math.max(0,Math.min(1,RGB[1]/255)),newRGB.blue=Math.max(0,Math.min(1,RGB[2]/255)),newRGB.alpha=void 0!==RGB[3]?Math.max(0,Math.min(1,RGB[3])):1,newRGB},toCSSHex:function(bytes){bytes=bytes||2;var max=Math.pow(16,bytes)-1,css=["#",pad(Math.round(this.red*max).toString(16).toUpperCase(),bytes),pad(Math.round(this.green*max).toString(16).toUpperCase(),bytes),pad(Math.round(this.blue*max).toString(16).toUpperCase(),bytes)];return css.join("")},toCSS:function(bytes){if(1===this.alpha)return this.toCSSHex(bytes);var max=255,components=["rgba(",Math.max(0,Math.min(max,Math.round(this.red*max))),",",Math.max(0,Math.min(max,Math.round(this.green*max))),",",Math.max(0,Math.min(max,Math.round(this.blue*max))),",",Math.max(0,Math.min(1,this.alpha)),")"];return components.join("")},toHSV:function(){var min,max,delta,hsv=factories.HSV();return min=Math.min(this.red,this.green,this.blue),max=Math.max(this.red,this.green,this.blue),hsv.value=max,delta=max-min,0==delta?hsv.hue=hsv.saturation=0:(hsv.saturation=delta/max,hsv.hue=this.red==max?(this.green-this.blue)/delta:this.green==max?2+(this.blue-this.red)/delta:4+(this.red-this.green)/delta,hsv.hue=(60*hsv.hue+360)%360),hsv.alpha=this.alpha,hsv},toHSL:function(){return this.toHSV().toHSL()},toRGB:function(){return this.clone()}}),transparent=color.fromObject({red:0,blue:0,green:0,alpha:0}),registerModel("HSV",{hue:0,saturation:0,value:1,alpha:1,shiftHue:cloneOnApply(function(degrees){var hue=(this.hue+degrees)%360;0>hue&&(hue=(360+hue)%360),this.hue=hue}),devalueByAmount:cloneOnApply(function(val){this.value=Math.min(1,Math.max(this.value-val,0))}),devalueByRatio:cloneOnApply(function(val){this.value=Math.min(1,Math.max(this.value*(1-val),0))}),valueByAmount:cloneOnApply(function(val){this.value=Math.min(1,Math.max(this.value+val,0))}),valueByRatio:cloneOnApply(function(val){this.value=Math.min(1,Math.max(this.value*(1+val),0))}),desaturateByAmount:cloneOnApply(function(val){this.saturation=Math.min(1,Math.max(this.saturation-val,0))}),desaturateByRatio:cloneOnApply(function(val){this.saturation=Math.min(1,Math.max(this.saturation*(1-val),0))}),saturateByAmount:cloneOnApply(function(val){this.saturation=Math.min(1,Math.max(this.saturation+val,0))}),saturateByRatio:cloneOnApply(function(val){this.saturation=Math.min(1,Math.max(this.saturation*(1+val),0))}),schemeFromDegrees:function(degrees){for(var newColors=[],i=0,j=degrees.length;j>i;i++){var col=this.clone();col.hue=(this.hue+degrees[i])%360,newColors.push(col)}return newColors},circularPalette:function(n){for(var degrees=[],i=0;n>i;i+=1)degrees[i]=this.hue+360/n*i;return this.schemeFromDegrees(degrees)},gradientPalette:function(other,n){for(var colors=[],i=0;n>i;i+=1){var c=this.clone();c=c.setHue(this.getHue()+(other.getHue()-this.getHue())/n*i),c=c.setSaturation(this.getSaturation()+(other.getSaturation()-this.getSaturation())/n*i),c=c.setValue(this.getValue()+(other.getValue()-this.getValue())/n*i),colors.push(c)}return colors},complementaryScheme:function(){return this.schemeFromDegrees([0,180])},splitComplementaryScheme:function(){return this.schemeFromDegrees([0,150,320])},splitComplementaryCWScheme:function(){return this.schemeFromDegrees([0,150,300])},splitComplementaryCCWScheme:function(){return this.schemeFromDegrees([0,60,210])},triadicScheme:function(){return this.schemeFromDegrees([0,120,240])},clashScheme:function(){return this.schemeFromDegrees([0,90,270])},tetradicScheme:function(){return this.schemeFromDegrees([0,90,180,270])},fourToneCWScheme:function(){return this.schemeFromDegrees([0,60,180,240])},fourToneCCWScheme:function(){return this.schemeFromDegrees([0,120,180,300])},fiveToneAScheme:function(){return this.schemeFromDegrees([0,115,155,205,245])},fiveToneBScheme:function(){return this.schemeFromDegrees([0,40,90,130,245])},fiveToneCScheme:function(){return this.schemeFromDegrees([0,50,90,205,320])},fiveToneDScheme:function(){return this.schemeFromDegrees([0,40,155,270,310])},fiveToneEScheme:function(){return this.schemeFromDegrees([0,115,230,270,320])},sixToneCWScheme:function(){return this.schemeFromDegrees([0,30,120,150,240,270])},sixToneCCWScheme:function(){return this.schemeFromDegrees([0,90,120,210,240,330])},neutralScheme:function(){return this.schemeFromDegrees([0,15,30,45,60,75])},analogousScheme:function(){return this.schemeFromDegrees([0,30,60,90,120,150])},fromObject:function(o){if(o.hasOwnProperty("hue")&&o.hasOwnProperty("saturation")&&o.hasOwnProperty("value")){var hsv=factories.HSV();return hsv.hue=o.hue,hsv.saturation=o.saturation,hsv.value=o.value,hsv.alpha=o.hasOwnProperty("alpha")?o.alpha:1,hsv}return null},_normalise:function(){this.hue%=360,this.saturation=Math.min(Math.max(0,this.saturation),1),this.value=Math.min(Math.max(0,this.value)),this.alpha=Math.min(1,Math.max(0,this.alpha))},toRGB:function(){this._normalise();var i,f,p,q,t,rgb=factories.RGB();if(0===this.saturation)return rgb.red=this.value,rgb.green=this.value,rgb.blue=this.value,rgb.alpha=this.alpha,rgb;var h=this.hue/60;switch(i=Math.floor(h),f=h-i,p=this.value*(1-this.saturation),q=this.value*(1-this.saturation*f),t=this.value*(1-this.saturation*(1-f)),i){case 0:rgb.red=this.value,rgb.green=t,rgb.blue=p;break;case 1:rgb.red=q,rgb.green=this.value,rgb.blue=p;break;case 2:rgb.red=p,rgb.green=this.value,rgb.blue=t;break;case 3:rgb.red=p,rgb.green=q,rgb.blue=this.value;break;case 4:rgb.red=t,rgb.green=p,rgb.blue=this.value;break;default:rgb.red=this.value,rgb.green=p,rgb.blue=q}return rgb.alpha=this.alpha,rgb},toHSL:function(){this._normalise();var hsl=factories.HSL();hsl.hue=this.hue;var l=(2-this.saturation)*this.value,s=this.saturation*this.value;return l&&2-l&&(s/=1>=l?l:2-l),l/=2,hsl.saturation=s,hsl.lightness=l,hsl.alpha=this.alpha,hsl},toHSV:function(){return this.clone()}}),registerModel("HSL",{hue:0,saturation:0,lightness:0,alpha:1,darkenByAmount:cloneOnApply(function(val){this.lightness=Math.min(1,Math.max(this.lightness-val,0))}),darkenByRatio:cloneOnApply(function(val){this.lightness=Math.min(1,Math.max(this.lightness*(1-val),0))}),lightenByAmount:cloneOnApply(function(val){this.lightness=Math.min(1,Math.max(this.lightness+val,0))}),lightenByRatio:cloneOnApply(function(val){this.lightness=Math.min(1,Math.max(this.lightness*(1+val),0))}),fromObject:function(o){return"string"==typeof o?this._fromCSS(o):o.hasOwnProperty("hue")&&o.hasOwnProperty("saturation")&&o.hasOwnProperty("lightness")?this._fromHSL(o):void 0},_fromCSS:function(css){var colorGroups=trim(css).match(hsl_hsla_regex);if(!colorGroups||!!colorGroups[1]+!!colorGroups[5]===1)return null;var hsl=factories.HSL();return hsl.hue=(colorGroups[2]%360+360)%360,hsl.saturation=Math.max(0,Math.min(parseInt(colorGroups[3],10)/100,1)),hsl.lightness=Math.max(0,Math.min(parseInt(colorGroups[4],10)/100,1)),hsl.alpha=colorGroups[5]?Math.max(0,Math.min(1,parseFloat(colorGroups[6]))):1,hsl},_fromHSL:function(HSL){var newHSL=factories.HSL();return newHSL.hue=HSL.hue,newHSL.saturation=HSL.saturation,newHSL.lightness=HSL.lightness,newHSL.alpha=HSL.hasOwnProperty("alpha")?HSL.alpha:1,newHSL},_normalise:function(){this.hue=(this.hue%360+360)%360,this.saturation=Math.min(Math.max(0,this.saturation),1),this.lightness=Math.min(Math.max(0,this.lightness)),this.alpha=Math.min(1,Math.max(0,this.alpha))},toHSL:function(){return this.clone()},toHSV:function(){this._normalise();var hsv=factories.HSV();hsv.hue=this.hue;var l=2*this.lightness,s=this.saturation*(1>=l?l:2-l);return hsv.value=(l+s)/2,hsv.saturation=2*s/(l+s)||0,hsv.alpha=this.alpha,hsv},toRGB:function(){return this.toHSV().toRGB()}}),Color.isValid=function(str){var key,c=Color(str),length=0;for(key in c)c.hasOwnProperty(key)&&length++;return length>0},net.brehaut.Color=Color,algo.Color=net.brehaut.Color,algo.Color.iBLUE=new algo.Color("#3266B5"),algo.Color.iGREEN=new algo.Color("#89B632"),algo.Color.iCYAN=new algo.Color("#30ADAD"),algo.Color.iORANGE=new algo.Color("#E89200"),algo.Color.iRED=new algo.Color("#B23A31"),algo.Color.iWHITE=new algo.Color("#FFFFFF"),algo.Color.iBLACK=new algo.Color("#000000"),algo.Color.iGRAY=new algo.Color("#CCCCCC"),algo.Color.iTRANSPARENT=new algo.Color("transparent")}).call(net.brehaut);var module;module&&(module.exports.Color=net.brehaut.Color);var algo=algo||{};algo.core={},algo.core.extends=function(progenitor,progeny){progeny.prototype=Object.create(progenitor.prototype),progeny.prototype.constructor=progeny},algo.core.compareItems=function(a,b,comparator){return comparator?comparator(a,b):a===b?0:b>a?-1:1},algo.core.isEmptyArray=function(a){return _.isArray(a)&&0===a.length},algo.core.isArrayLengthAtLeast=function(a,length){return _.isArray(a)&&a.length>=length},algo.core.randomizeArray=function(a,min,max,seed){for(var r=algo.core.randomInteger(min,max,algo.core.random(seed)),i=0;i<a.length;i+=1)a[i]=r();return a},algo.core.fillArray=function(a,value,step){for(var s=step||0,i=0;i<a.length;i+=1)a[i]=value,value+=s;return a},algo.core.createMultiArray=function(){function createArrayInternal(a){for(var i=0;i<arguments[1];i+=1)a[i]=2===arguments.length?0:createArrayInternal.apply(this,[[]].concat(_.toArray(arguments).slice(2)));return a}return createArrayInternal.apply(this,[[]].concat(_.toArray(arguments)))},algo.core.copyArray=function(a,start,end){var s=start||0,e=end||a.length;return a.slice(s,e)},algo.core.copyArrayStart=function(a,n){return a.slice(0,n)},algo.core.copyArrayEnd=function(a,n){return a.slice(-n)},algo.core.reverseArray=function(a,start,end){for(end||a.length;end>start;)algo.core.swapArray(a,start++,--end)},algo.core.swapArray=function(a,x,y){var temp=a[x];a[x]=a[y],a[y]=temp},algo.core.swapProperties=function(p,a,b){var temp=a[p];a[p]=b[p],b[p]=temp},algo.core.shuffleArray=function(a){return _.shuffle(a)},algo.core.compare=function(a,b,comparator){if(!_.isArray(a)||!_.isArray(b)||a.length!==b.length)return!1;for(var i=0;i<a.length;i+=1){var comp=algo.core.compareItems(a[i],b[i],comparator);if(0!==comp)return!1}return!0},algo.core.binarySearchArray=function(a,v,c){if(algo.core.isEmptyArray(a))return null;for(var left=0,right=a.length-1;right>=left;){var mid=left+right>>1,compareResult=algo.core.compareItems(v,a[mid],c);if(0===compareResult)return v;0>compareResult?right=mid-1:left=mid+1}return null},algo.core.quickSortArray=function(a,start,end,comparator){var pivot=algo.core.quickSortPartition(a,0,a.length,comparator);algo.core.quickSortArray(a,start,pivot-1,comparator),algo.core.quickSortArray(a,pivot+1,end,comparator)},algo.core.quickSortPartition=function(a,left,right,comparator){for(var i=left,j=right,v=a[right];;){for(;algo.core.compareItems(a[i],v,comparator)<0;)i+=1;for(;algo.core.compareItems(v<a[--j])<0&&!(i>=j););if(i>=j)break;algo.core.swapArray(a,i,j)}return algo.core.swapArray(a,i,right),i},algo.core.mergeSortArray=function(a){if(!algo.core.isArrayLengthAtLeast(a,2))return a.slice();var pivot=a.length>>1,left=algo.core.mergeSortArray(a.slice(0,pivot)),right=algo.core.mergeSortArray(a.slice(pivot));return algo.core.merge(left,right)},algo.core.merge=function(a,b){for(var ai=0,bi=0,results=[];ai<a.length&&bi<b.length;)results.push(a[ai]<b[bi]?a[ai++]:b[bi++]);return results.concat(a.slice(ai)).concat(b.slice(bi))},algo.core.factorial=function(n){return 1>=n?1:n*algo.core.factorial(n-1)},algo.core.degreesToRadians=function(d){return d*(Math.PI/180)},algo.core.radiansToDegrees=function(r){return r*(180/Math.PI)},algo.core.pointOnCircle=function(cx,cy,radius,degrees){return algo.core.pointOnEllipse(cx,cy,radius,radius,degrees)},algo.core.pointOnEllipse=function(cx,cy,radiusX,radiusY,degrees){var d=0>degrees?360+degrees%360:degrees%360;return{x:cx+radiusX*Math.cos(algo.core.degreesToRadians(d)),y:cy+radiusY*Math.sin(algo.core.degreesToRadians(d))}},algo.core.random=function(_seed){function random(){return seed=(9301*seed+49297)%233280,seed/233280}var seed=(0>_seed?-1*_seed:_seed)||12347;return random},algo.core.randomInteger=function(_min,_max,_rgen){function random(){return min+rgen()*(max-min)>>0}var rgen=_rgen||Math.random,max=_max,min=_min;return random},algo.core.randomFloat=function(_min,_max,_rgen){function random(){return min+rgen()*(max-min)}var rgen=_rgen||Math.random,max=_max,min=_min;return random},algo.core.stringToArray=function(s){return s.split("")},algo.core.reverseString=function(s){return s.split("").reverse().join("")},algo.core.sortLetters=function(s){if(s){var a=s.split("");return a.sort(),a.join("")}return null},algo.core.hasProperties=function(obj){for(var i=1;i<arguments.length;i+=1)if(!_.has(obj,arguments[i]))return!1;return!0},algo.core.hasAny=function(obj){for(var i=1;i<arguments.length;i+=1)if(_.has(obj,arguments[i]))return!0;return!1},algo.core.isPointLike=function(obj){return algo.core.hasProperties(obj,"x","y")},algo.core.isLineLike=function(obj){return algo.core.hasProperties(obj,"x1","y1","x2","y2")},algo.core.isRectLike=function(obj){return algo.core.hasProperties(obj,"x","y","w","h")},algo.core.isCircleLike=function(obj){return algo.core.hasProperties(obj,"x","y","radius")},algo.core.DataStructure=function(options){this.options=_.clone(options||{})},algo.core.DataStructure.prototype.invoke=function(functionName){if(this.hasFunction(functionName)){var args=_.toArray(arguments).slice(1);return this.options[functionName].apply(this,args)}return void 0},algo.core.DataStructure.prototype.hasFunction=function(functionName){return this.options&&this.options[functionName]},algo.core.Graph=function(options){algo.core.DataStructure.call(this,options),this.vertices={},this.edges={},this.nextVertexId=this.nextEdgeId=0},algo.core.extends(algo.core.DataStructure,algo.core.Graph),algo.core.Graph.prototype.addVertex=function(properties){var vertex=new algo.core.GraphVertex(this.nextVertexId++,properties);return this.vertices[vertex.id]=vertex,vertex.element=this.invoke.call(this,"createVertex",vertex,this),vertex},algo.core.Graph.prototype.removeVertex=function(vertex){vertex.element&&(this.hasFunction("destroyVertex")?this.invoke("destroyVertex",vertex,vertex.element,this):(vertex.element.destroy(),vertex.element=null));var u=_.union(_.values(vertex.outEdges),_.values(vertex.inEdges));return _.each(u,function(edge){this.removeEdge(edge)},this),delete this.vertices[vertex.id],u},algo.core.Graph.prototype.addEdge=function(source,target,properties){var edge=new algo.core.GraphEdge(this.nextEdgeId++,source,target,properties);return this.edges[edge.id]=edge,edge.element=this.invoke("createEdge",edge,this),edge},algo.core.Graph.prototype.removeEdge=function(edge){edge.element&&(this.hasFunction("destroyEdge")?this.invoke("destroyEdge",edge,edge.element,this):(edge.element.destroy(),edge.element=null)),delete this.edges[edge.id],delete edge.source.outEdges[edge.id],delete edge.target.inEdges[edge.id]},algo.core.Graph.prototype.removeEdgelessVertices=function(){_.each(this.vertices,_.bind(function(v){0===_.keys(this.getVertexEdges(v)).length&&this.removeVertex(v)},this))},algo.core.Graph.prototype.findVertices=function(property,value){return _.filter(this.vertices,function(vertex){return vertex[property]===value},this)},algo.core.Graph.prototype.getEdges=function(source,target){return _.filter(source.outEdges,function(edge){return edge.target.id===target.id})},algo.core.Graph.prototype.hasEdge=function(source,target){return this.getEdges(source,target).length>0},algo.core.Graph.prototype.getVertexEdges=function(vertex){return _.union(_.values(vertex.outEdges),_.values(vertex.inEdges))},algo.core.Graph.prototype.getInVertices=function(vertex){return _.uniq(_.map(vertex.inEdges,function(e){return e.source},this))},algo.core.Graph.prototype.getOutVertices=function(vertex){return _.uniq(_.map(vertex.outEdges,function(e){return e.target},this))},algo.core.Graph.prototype.getAdjacentVertices=function(vertex){var a=_.isArray(vertex)?vertex:[vertex],list=[];return _.each(a,function(v){list=list.concat(this.getInVertices(v)).concat(this.getOutVertices(v))},this),_.filter(_.uniq(list),function(v){return a.indexOf(v)<0},this)},algo.core.Graph.prototype.addRandomEdge=function(properties){var vrandom=_.shuffle(_.values(this.vertices));if(vrandom.length<2)return null;for(var i=0;i<vrandom.length;){var j=(i+1)%vrandom.length,v1=vrandom[i],v2=vrandom[j];
if(this.getEdges(v1,v2).length+this.getEdges(v2,v1).length===0)return this.addEdge(v1,v2,properties);i+=1}return null},algo.core.Graph.prototype.getComponents=function(){function depthFirstSearch(component,vertex){return component.indexOf(vertex)<0&&(component.push(unconnected.splice(unconnected.indexOf(vertex),1)[0]),_.each(this.getAdjacentVertices(vertex),function(v){depthFirstSearch.call(this,component,v)},this)),component}for(var components=[],unconnected=_.values(this.vertices);unconnected.length;)components.push(depthFirstSearch.call(this,[],unconnected[0]));return components.sort(function(a,b){return b.length-a.length})},algo.core.GraphVertex=function(id,properties){this.id=id,this.outEdges={},this.inEdges={},_.extend(this,properties),this.propertyNames=properties?_.keys(properties):[]},algo.core.GraphEdge=function(id,source,target,properties){this.id=id,this.source=source,this.target=target,_.extend(this,properties),source.outEdges[this.id]=this,target.inEdges[this.id]=this},algo.core.GraphEdge.prototype.setTarget=function(newTarget){delete this.target.inEdges[this.id],this.target=newTarget,this.target.inEdges[this.id]=this},algo.core.GraphEdge.prototype.setSource=function(newSource){delete this.source.outEdges[this.id],this.source=newSource,this.source.outEdges[this.id]=this},algo.core.GraphEdge.isSelfConnected=function(){return this.source.id===this.target.id},algo.core.BinaryTree=function(options){algo.core.Graph.call(this,options)},algo.core.extends(algo.core.Graph,algo.core.BinaryTree),algo.core.BinaryTree.prototype.setParents=function(currentNode,parent){currentNode&&(currentNode.parent=parent,this.setParents(currentNode.left,currentNode),this.setParents(currentNode.right,currentNode))},algo.core.BinaryTree.prototype.addVertex=function(properties){var n=new algo.core.TreeVertex(this,this.nextVertexId++,properties);if(this.vertices[n.id]=n,n.element=this.invoke.call(this,"createVertex",n,this),this.root)for(var c=this.root;;){var comp=algo.core.compareItems(n.value,c.value,this.options.comparator);if(0===comp)return this.removeVertex(n),null;if(0>comp){if(!c.left){c.left=n;break}c=c.left}else{if(!c.right){c.right=n;break}c=c.right}}else this.root=n;return this.setParents(this.root,null),n},algo.core.BinaryTree.prototype.add=function(value){return this.addVertex({value:value})},algo.core.BinaryTree.prototype.removeVertex=function(v){var childCount=(v.left?1:0)+(v.right?1:0),wasRoot=v===this.root;switch(childCount){case 0:wasRoot?this.root=null:v.parent.left===v?v.parent.left=null:v.parent.right=null;break;case 1:if(wasRoot){this.root=v.left||v.right;break}v.parent.left===v?v.parent.left=v.left||v.right:v.parent.right=v.left||v.right;break;case 2:var min=this.min(v.right,v);v.parent&&(v.parent.left===v?v.parent.left=min:v.parent.right=min),min.left=v.left,min!==v.right&&(min.parent.left=min.right,min.right=v.right),wasRoot&&(this.root=min)}this.setParents(this.root,null),algo.core.Graph.prototype.removeVertex.call(this,v)},algo.core.BinaryTree.prototype.remove=function(value){var vertex=this.findVertex(value);vertex&&this.removeVertex(vertex)},algo.core.BinaryTree.prototype.findVertex=function(value){for(var current=this.root;current;){var c=algo.core.compareItems(current.value,value,this.options.comparator);if(0===c)break;current=c>0?current.left:current.right}return current},algo.core.BinaryTree.prototype.min=function(n){return n&&n.left?this.min(n.left):n},algo.core.BinaryTree.prototype.max=function(n){return n&&n.right?this.max(n.right):n},algo.core.TreeVertex=function(tree,id,properties){algo.core.GraphVertex.call(this,id,properties),this.tree=tree,Object.defineProperty(this,"left",{enumerable:!0,get:function(){return this.leftVertex},set:function(v){v!==this.leftVertex&&(this.leftVertex=v,!this.leftVertex&&this.leftEdge?(this.tree.removeEdge(this.leftEdge),this.leftEdge=null):this.leftEdge?this.leftEdge.setTarget(this.leftVertex):this.leftEdge=this.tree.addEdge(this,this.leftVertex))}}),Object.defineProperty(this,"right",{enumerable:!0,get:function(){return this.rightVertex},set:function(v){v!==this.rightVertex&&(this.rightVertex=v,!this.rightVertex&&this.rightEdge?(this.tree.removeEdge(this.rightEdge),this.rightEdge=null):this.rightEdge?this.rightEdge.setTarget(this.rightVertex):this.rightEdge=this.tree.addEdge(this,this.rightVertex))}}),Object.defineProperty(this,"parent",{enumerable:!0,get:function(){return this.parentVertex},set:function(v){this.parentVertex=v}})},algo.core.extends(algo.core.GraphVertex,algo.core.TreeVertex),algo.core.Heap=function(options){algo.core.DataStructure.call(this,options),this.nodes=[],this.n=0},algo.core.extends(algo.core.DataStructure,algo.core.Heap),algo.core.Heap.isEmpty=function(){return 0===this.n},algo.core.Heap.kROOT=1,algo.core.Heap.prototype.value=function(i){return this.nodes[i].value},algo.core.Heap.prototype.payload=function(i){return this.nodes[i].payload},algo.core.Heap.prototype.element=function(i){return this.nodes[i].element},algo.core.Heap.prototype.swap=function(i,j){var temp=this.nodes[i];this.nodes[i]=this.nodes[j],this.nodes[j]=temp},algo.core.Heap.prototype.leftChild=function(i){return 2*i},algo.core.Heap.prototype.rightChild=function(i){return 2*i+1},algo.core.Heap.prototype.parent=function(i){return i>>1},algo.core.Heap.prototype.isNull=function(i){return i<algo.core.Heap.kROOT||i>this.n},algo.core.Heap.prototype.isEmpty=function(){return 0===this.n},algo.core.Heap.prototype.enqueue=function(v,payload){this.nodes[algo.core.Heap.kROOT+this.n]={value:v,payload:payload,element:this.invoke.call(this,"createVertex",v,this)},this.siftUp(algo.core.Heap.kROOT+this.n++)},algo.core.Heap.prototype.dequeue=function(){var min=this.nodes[algo.core.Heap.kROOT];return min.element&&this.invoke("destroyVertex",min.value,min.element,this),this.n--,this.n>0&&(this.nodes[algo.core.Heap.kROOT]=this.nodes[algo.core.Heap.kROOT+this.n],this.siftDown(algo.core.Heap.kROOT)),min},algo.core.Heap.prototype.siftDown=function(i){for(var left=this.leftChild(i),right=this.rightChild(i),hasLeft=!this.isNull(left),hasRight=!this.isNull(right);hasLeft||hasRight;){var leftValue=hasLeft?this.value(left):Number.MAX_VALUE,rightValue=hasRight?this.value(right):Number.MAX_VALUE,v=this.value(i);if(leftValue>v&&rightValue>v)return;var swapIndex=rightValue>leftValue?left:right;this.swap(i,swapIndex),i=swapIndex,left=this.leftChild(i),right=this.rightChild(i),hasLeft=!this.isNull(left),hasRight=!this.isNull(right)}},algo.core.Heap.prototype.siftUp=function(i){for(var v=this.value(i);!this.isNull(this.parent(i))&&this.value(this.parent(i))>v;)this.swap(i,this.parent(i)),i=this.parent(i)},algo.core.PixelBuffer=function(options){algo.core.DataStructure.call(this,options),this.w=options.width,this.h=options.height,this.pb=algo.core.createMultiArray(this.w,this.h),this.e=algo.core.createMultiArray(this.w,this.h)},algo.core.extends(algo.core.DataStructure,algo.core.PixelBuffer),algo.core.PixelBuffer.prototype.getPixel=function(x,y){if(0>x||x>=this.w||0>y||y>=this.h)throw new Error("Pixel index out of bounds");return 0===this.pb[x][y]?null:this.pb[x][y]},algo.core.PixelBuffer.prototype.setPixel=function(x,y,v){if(0>x||x>=this.w||0>y||y>=this.h)throw new Error("Pixel index out of bounds");var pixel=v;pixel instanceof algo.Color||(pixel=new algo.Color(pixel)),this.pb[x][y]=pixel,this.e[x][y]||(this.e[x][y]=this.invoke.call(this,"createPixel",x,y)),this.e[x][y]&&this.invoke.call(this,"updatePixel",x,y,this.pb[x][y],this.e[x][y])},algo.core.PixelBuffer.prototype.clearPixel=function(x,y){if(0>x||x>=this.w||0>y||y>=this.h)throw new Error("Pixel index out of bounds");this.pb[x][y]=0,this.e[x][y]&&(this.invoke.call(this,"destroyPixel",x,y,this.e[x][y]),this.e[x][y]=0)},algo.core.PixelBuffer.prototype.clear=function(){for(var y=0;y<this.h;y+=1)for(var x=0;x<this.w;x+=1)this.clearPixel(x,y)},algo.core.Array=function(options){this.a=[],this.options=_.clone(options),_.each(this.options.data,function(e){this.push(e)},this),Object.defineProperty(this,"length",{enumerable:!0,get:function(){return this.a.length}})},algo.core.extends(algo.core.DataStructure,algo.core.Array),algo.core.Array.prototype.validateIndex=function(index){if(0>index||index>=this.a.length)throw new Error("Invalid Index")},algo.core.Array.prototype.updateElements=function(){for(var index=index+1;index<this.a.length;index+=1){var item=this.a[index];item.element&&this.invoke("updateElement",item.value,index,item.element)}},algo.core.Array.prototype.insertAt=function(value,index){if(0>index||index>this.a.length)throw new Error("Invalid Index");this.a.splice(index,0,{value:value,element:this.invoke("createElement",value,index)}),this.updateElements()},algo.core.Array.prototype.push=function(value){this.insertAt(value,this.a.length)},algo.core.Array.prototype.removeAt=function(index){this.validateIndex(index);var item=this.a.splice(index,1)[0];item.element&&this.invoke("destroyElement",item.element),this.updateElements()},algo.core.Array.prototype.pop=function(){this.removeAt(this.a.length-1)},algo.core.Array.prototype.getValue=function(index){return this.validateIndex(index),this.a[index].value},algo.core.Array.prototype.getValueAccessor=function(){return _.bind(function(index){return this.validateIndex(index),this.a[index].value},this)},algo.core.Array.prototype.getElement=function(index){return this.validateIndex(index),this.a[index].element},algo.core.Array.prototype.getElementAccessor=function(){return _.bind(function(index){return this.validateIndex(index),this.a[index].element},this)},algo.core.Array.prototype.getItem=function(index){return this.validateIndex(index),this.a[index]},algo.core.Array.prototype.setValue=function(index,value){this.validateIndex(index);var item=this.a[index];item.value=value,item.element&&this.invoke("updateElement",item.value,index,item.element)},algo.core.Array.prototype.swap=function(x,y){this.validateIndex(x),this.validateIndex(y);var temp=this.a[x];this.a[x]=this.a[y],this.a[y]=temp,this.a[x].element&&this.invoke("swapElement",this.a[x].value,x,y,this.a[x].element),this.a[y].element&&this.invoke("swapElement",this.a[y].value,y,x,this.a[y].element)},function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){var global="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};global.dagre=require("./index")},{"./index":2}],2:[function(require,module,exports){exports.Digraph=require("graphlib").Digraph,exports.Graph=require("graphlib").Graph,exports.layout=require("./lib/layout"),exports.version=require("./lib/version"),exports.debug=require("./lib/debug")},{"./lib/debug":3,"./lib/layout":4,"./lib/version":19,graphlib:25}],3:[function(require,module,exports){var util=require("./util");exports.dotOrdering=function(g){function dfs(u){var children=g.children(u);children.length?(result+="subgraph cluster_"+u+" {",result+='label="'+u+'";',children.forEach(function(v){dfs(v)}),result+="}"):(result+=u,g.node(u).dummy&&(result+=" [shape=diamond]"),result+=";")}var ordering=util.ordering(g.filterNodes(util.filterNonSubgraphs(g))),result="digraph {";return g.children(null).forEach(dfs),ordering.forEach(function(layer){result+='subgraph { rank=same; edge [style="invis"];',result+=layer.join("->"),result+="}"}),g.eachEdge(function(e,u,v){result+=u+"->"+v+";"}),result+="}"}},{"./util":18}],4:[function(require,module){var util=require("./util"),rank=require("./rank"),order=require("./order"),CGraph=require("graphlib").CGraph,CDigraph=require("graphlib").CDigraph;module.exports=function(){function initLayoutGraph(inputGraph){var g=new CDigraph;inputGraph.eachNode(function(u,value){void 0===value&&(value={}),g.addNode(u,{width:value.width,height:value.height}),value.hasOwnProperty("rank")&&(g.node(u).prefRank=value.rank)}),inputGraph.parent&&inputGraph.nodes().forEach(function(u){g.parent(u,inputGraph.parent(u))}),inputGraph.eachEdge(function(e,u,v,value){void 0===value&&(value={});var newValue={e:e,minLen:value.minLen||1,width:value.width||0,height:value.height||0,points:[]};g.addEdge(null,u,v,newValue)});var graphValue=inputGraph.graph()||{};return g.graph({rankDir:graphValue.rankDir||config.rankDir,orderRestarts:graphValue.orderRestarts}),g}function run(inputGraph){var g,rankSep=self.rankSep();try{return g=util.time("initLayoutGraph",initLayoutGraph)(inputGraph),0===g.order()?g:(g.eachEdge(function(e,s,t,a){a.minLen*=2}),self.rankSep(rankSep/2),util.time("rank.run",rank.run)(g,config.rankSimplex),util.time("normalize",normalize)(g),util.time("order",order)(g,config.orderMaxSweeps),util.time("position",position.run)(g),util.time("undoNormalize",undoNormalize)(g),util.time("fixupEdgePoints",fixupEdgePoints)(g),util.time("rank.restoreEdges",rank.restoreEdges)(g),util.time("createFinalGraph",createFinalGraph)(g,inputGraph.isDirected()))}finally{self.rankSep(rankSep)}}function normalize(g){var dummyCount=0;g.eachEdge(function(e,s,t,a){var sourceRank=g.node(s).rank,targetRank=g.node(t).rank;if(targetRank>sourceRank+1){for(var u=s,rank=sourceRank+1,i=0;targetRank>rank;++rank,++i){var v="_D"+ ++dummyCount,node={width:a.width,height:a.height,edge:{id:e,source:s,target:t,attrs:a},rank:rank,dummy:!0};0===i?node.index=0:rank+1===targetRank&&(node.index=1),g.addNode(v,node),g.addEdge(null,u,v,{}),u=v}g.addEdge(null,u,t,{}),g.delEdge(e)}})}function undoNormalize(g){g.eachNode(function(u,a){if(a.dummy){if("index"in a){var edge=a.edge;g.hasEdge(edge.id)||g.addEdge(edge.id,edge.source,edge.target,edge.attrs);var points=g.edge(edge.id).points;points[a.index]={x:a.x,y:a.y,ul:a.ul,ur:a.ur,dl:a.dl,dr:a.dr}}g.delNode(u)}})}function fixupEdgePoints(g){g.eachEdge(function(e,s,t,a){a.reversed&&a.points.reverse()})}function createFinalGraph(g,isDirected){var out=isDirected?new CDigraph:new CGraph;out.graph(g.graph()),g.eachNode(function(u,value){out.addNode(u,value)}),g.eachNode(function(u){out.parent(u,g.parent(u))}),g.eachEdge(function(e,u,v,value){out.addEdge(value.e,u,v,value)});var maxX=0,maxY=0;return g.eachNode(function(u,value){g.children(u).length||(maxX=Math.max(maxX,value.x+value.width/2),maxY=Math.max(maxY,value.y+value.height/2))}),g.eachEdge(function(e,u,v,value){var maxXPoints=Math.max.apply(Math,value.points.map(function(p){return p.x})),maxYPoints=Math.max.apply(Math,value.points.map(function(p){return p.y}));maxX=Math.max(maxX,maxXPoints+value.width/2),maxY=Math.max(maxY,maxYPoints+value.height/2)}),out.graph().width=maxX,out.graph().height=maxY,out}function delegateProperty(f){return function(){return arguments.length?(f.apply(null,arguments),self):f()}}var config={debugLevel:0,orderMaxSweeps:order.DEFAULT_MAX_SWEEPS,rankSimplex:!1,rankDir:"TB"},position=require("./position")(),self={};return self.orderIters=util.propertyAccessor(self,config,"orderMaxSweeps"),self.rankSimplex=util.propertyAccessor(self,config,"rankSimplex"),self.nodeSep=delegateProperty(position.nodeSep),self.edgeSep=delegateProperty(position.edgeSep),self.universalSep=delegateProperty(position.universalSep),self.rankSep=delegateProperty(position.rankSep),self.rankDir=util.propertyAccessor(self,config,"rankDir"),self.debugAlignment=delegateProperty(position.debugAlignment),self.debugLevel=util.propertyAccessor(self,config,"debugLevel",function(x){util.log.level=x,position.debugLevel(x)}),self.run=util.time("Total layout",run),self._normalize=normalize,self}},{"./order":5,"./position":10,"./rank":11,"./util":18,graphlib:25}],5:[function(require,module){function order(g,maxSweeps){function saveAllTimeBest(){g.eachNode(function(u,value){allTimeBest[u]=value.order})}arguments.length<2&&(maxSweeps=DEFAULT_MAX_SWEEPS);var restarts=g.graph().orderRestarts||0,layerGraphs=initLayerGraphs(g);layerGraphs.forEach(function(lg){lg=lg.filterNodes(function(u){return!g.children(u).length})});for(var currentBestCC,iters=0,allTimeBestCC=Number.MAX_VALUE,allTimeBest={},j=0;j<Number(restarts)+1&&0!==allTimeBestCC;++j){currentBestCC=Number.MAX_VALUE,initOrder(g,restarts>0),util.log(2,"Order phase start cross count: "+g.graph().orderInitCC);var i,lastBest,cc;for(i=0,lastBest=0;4>lastBest&&maxSweeps>i&&currentBestCC>0;++i,++lastBest,++iters)sweep(g,layerGraphs,i),cc=crossCount(g),currentBestCC>cc&&(lastBest=0,currentBestCC=cc,allTimeBestCC>cc&&(saveAllTimeBest(),allTimeBestCC=cc)),util.log(3,"Order phase start "+j+" iter "+i+" cross count: "+cc)}Object.keys(allTimeBest).forEach(function(u){g.children&&g.children(u).length||(g.node(u).order=allTimeBest[u])}),g.graph().orderCC=allTimeBestCC,util.log(2,"Order iterations: "+iters),util.log(2,"Order phase best cross count: "+g.graph().orderCC)}function predecessorWeights(g,nodes){var weights={};return nodes.forEach(function(u){weights[u]=g.inEdges(u).map(function(e){return g.node(g.source(e)).order})}),weights}function successorWeights(g,nodes){var weights={};return nodes.forEach(function(u){weights[u]=g.outEdges(u).map(function(e){return g.node(g.target(e)).order})}),weights}function sweep(g,layerGraphs,iter){iter%2===0?sweepDown(g,layerGraphs,iter):sweepUp(g,layerGraphs,iter)}function sweepDown(g,layerGraphs){for(var cg,i=1;i<layerGraphs.length;++i)cg=sortLayer(layerGraphs[i],cg,predecessorWeights(g,layerGraphs[i].nodes()))}function sweepUp(g,layerGraphs){for(var cg,i=layerGraphs.length-2;i>=0;--i)sortLayer(layerGraphs[i],cg,successorWeights(g,layerGraphs[i].nodes()))}var util=require("./util"),crossCount=require("./order/crossCount"),initLayerGraphs=require("./order/initLayerGraphs"),initOrder=require("./order/initOrder"),sortLayer=require("./order/sortLayer");module.exports=order;var DEFAULT_MAX_SWEEPS=24;order.DEFAULT_MAX_SWEEPS=DEFAULT_MAX_SWEEPS},{"./order/crossCount":6,"./order/initLayerGraphs":7,"./order/initOrder":8,"./order/sortLayer":9,"./util":18}],6:[function(require,module){function crossCount(g){for(var cc=0,ordering=util.ordering(g),i=1;i<ordering.length;++i)cc+=twoLayerCrossCount(g,ordering[i-1],ordering[i]);return cc}function twoLayerCrossCount(g,layer1,layer2){var indices=[];layer1.forEach(function(u){var nodeIndices=[];g.outEdges(u).forEach(function(e){nodeIndices.push(g.node(g.target(e)).order)}),nodeIndices.sort(function(x,y){return x-y}),indices=indices.concat(nodeIndices)});for(var firstIndex=1;firstIndex<layer2.length;)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;for(var tree=[],i=0;treeSize>i;++i)tree[i]=0;var cc=0;return indices.forEach(function(i){var treeIndex=i+firstIndex;for(++tree[treeIndex];treeIndex>0;)treeIndex%2&&(cc+=tree[treeIndex+1]),treeIndex=treeIndex-1>>1,++tree[treeIndex]}),cc}var util=require("../util");module.exports=crossCount},{"../util":18}],7:[function(require,module){function initLayerGraphs(g){function dfs(u){if(null===u)return void g.children(u).forEach(function(v){dfs(v)});var value=g.node(u);value.minRank="rank"in value?value.rank:Number.MAX_VALUE,value.maxRank="rank"in value?value.rank:Number.MIN_VALUE;var uRanks=new Set;return g.children(u).forEach(function(v){var rs=dfs(v);uRanks=Set.union([uRanks,rs]),value.minRank=Math.min(value.minRank,g.node(v).minRank),value.maxRank=Math.max(value.maxRank,g.node(v).maxRank)}),"rank"in value&&uRanks.add(value.rank),uRanks.keys().forEach(function(r){r in ranks||(ranks[r]=[]),ranks[r].push(u)}),uRanks}var ranks=[];dfs(null);var layerGraphs=[];return ranks.forEach(function(us,rank){layerGraphs[rank]=g.filterNodes(nodesFromList(us))}),layerGraphs}var nodesFromList=require("graphlib").filter.nodesFromList,Set=require("cp-data").Set;module.exports=initLayerGraphs},{"cp-data":20,graphlib:25}],8:[function(require,module){function initOrder(g,random){var layers=[];g.eachNode(function(u,value){var layer=layers[value.rank];g.children&&g.children(u).length>0||(layer||(layer=layers[value.rank]=[]),layer.push(u))}),layers.forEach(function(layer){random&&util.shuffle(layer),layer.forEach(function(u,i){g.node(u).order=i})});var cc=crossCount(g);g.graph().orderInitCC=cc,g.graph().orderCC=Number.MAX_VALUE}var crossCount=require("./crossCount"),util=require("../util");module.exports=initOrder},{"../util":18,"./crossCount":6}],9:[function(require,module){function sortLayer(g,cg,weights){weights=adjustWeights(g,weights);var result=sortLayerSubgraph(g,null,cg,weights);return result.list.forEach(function(u,i){g.node(u).order=i}),result.constraintGraph}function sortLayerSubgraph(g,sg,cg,weights){cg=cg?cg.filterNodes(nodesFromList(g.children(sg))):new Digraph;var nodeData={};g.children(sg).forEach(function(u){if(g.children(u).length)nodeData[u]=sortLayerSubgraph(g,u,cg,weights),nodeData[u].firstSG=u,nodeData[u].lastSG=u;else{var ws=weights[u];nodeData[u]={degree:ws.length,barycenter:util.sum(ws)/ws.length,order:g.node(u).order,orderCount:1,list:[u]}}}),resolveViolatedConstraints(g,cg,nodeData);var keys=Object.keys(nodeData);keys.sort(function(x,y){return nodeData[x].barycenter-nodeData[y].barycenter||nodeData[x].order-nodeData[y].order});var result=keys.map(function(u){return nodeData[u]}).reduce(function(lhs,rhs){return mergeNodeData(g,lhs,rhs)});return result}function mergeNodeData(g,lhs,rhs){var cg=mergeDigraphs(lhs.constraintGraph,rhs.constraintGraph);return void 0!==lhs.lastSG&&void 0!==rhs.firstSG&&(void 0===cg&&(cg=new Digraph),cg.hasNode(lhs.lastSG)||cg.addNode(lhs.lastSG),cg.addNode(rhs.firstSG),cg.addEdge(null,lhs.lastSG,rhs.firstSG)),{degree:lhs.degree+rhs.degree,barycenter:(lhs.barycenter*lhs.degree+rhs.barycenter*rhs.degree)/(lhs.degree+rhs.degree),order:(lhs.order*lhs.orderCount+rhs.order*rhs.orderCount)/(lhs.orderCount+rhs.orderCount),orderCount:lhs.orderCount+rhs.orderCount,list:lhs.list.concat(rhs.list),firstSG:void 0!==lhs.firstSG?lhs.firstSG:rhs.firstSG,lastSG:void 0!==rhs.lastSG?rhs.lastSG:lhs.lastSG,constraintGraph:cg}}function mergeDigraphs(lhs,rhs){return void 0===lhs?rhs:void 0===rhs?lhs:(lhs=lhs.copy(),rhs.nodes().forEach(function(u){lhs.addNode(u)}),rhs.edges().forEach(function(e,u,v){lhs.addEdge(null,u,v)}),lhs)}function resolveViolatedConstraints(g,cg,nodeData){function collapseNodes(u,v,w){cg.inEdges(u).forEach(function(e){cg.delEdge(e),cg.addEdge(null,cg.source(e),w)}),cg.outEdges(v).forEach(function(e){cg.delEdge(e),cg.addEdge(null,w,cg.target(e))}),cg.delNode(u),cg.delNode(v)}for(var violated;void 0!==(violated=findViolatedConstraint(cg,nodeData));){for(var v,source=cg.source(violated),target=cg.target(violated);(v=cg.addNode(null))&&g.hasNode(v);)cg.delNode(v);nodeData[v]=mergeNodeData(g,nodeData[source],nodeData[target]),delete nodeData[source],delete nodeData[target],collapseNodes(source,target,v),0===cg.incidentEdges(v).length&&cg.delNode(v)}}function findViolatedConstraint(cg,nodeData){for(var us=topsort(cg),i=0;i<us.length;++i)for(var u=us[i],inEdges=cg.inEdges(u),j=0;j<inEdges.length;++j){var e=inEdges[j];if(nodeData[cg.source(e)].barycenter>=nodeData[u].barycenter)return e}}function adjustWeights(g,weights){var minW=Number.MAX_VALUE,maxW=0,adjusted={};g.eachNode(function(u){if(!g.children(u).length){var ws=weights[u];ws.length&&(minW=Math.min(minW,util.min(ws)),maxW=Math.max(maxW,util.max(ws)))}});var rangeW=maxW-minW;return g.eachNode(function(u){if(!g.children(u).length){var ws=weights[u];adjusted[u]=ws.length?ws.map(function(w){return rangeW?(w-minW)*(g.order()-1)/rangeW:g.order()-.5}):[g.node(u).order]}}),adjusted}var util=require("../util"),Digraph=require("graphlib").Digraph,topsort=require("graphlib").alg.topsort,nodesFromList=require("graphlib").filter.nodesFromList;module.exports=sortLayer},{"../util":18,graphlib:25}],10:[function(require,module){var util=require("./util");module.exports=function(){function run(g){g=g.filterNodes(util.filterNonSubgraphs(g));var layering=util.ordering(g),conflicts=findConflicts(g,layering),xss={};["u","d"].forEach(function(vertDir){"d"===vertDir&&layering.reverse(),["l","r"].forEach(function(horizDir){"r"===horizDir&&reverseInnerOrder(layering);var dir=vertDir+horizDir,align=verticalAlignment(g,layering,conflicts,"u"===vertDir?"predecessors":"successors");xss[dir]=horizontalCompaction(g,layering,align.pos,align.root,align.align),config.debugLevel>=3&&debugPositioning(vertDir+horizDir,g,layering,xss[dir]),"r"===horizDir&&flipHorizontally(xss[dir]),"r"===horizDir&&reverseInnerOrder(layering)}),"d"===vertDir&&layering.reverse()}),balance(g,layering,xss),g.eachNode(function(v){var xs=[];for(var alignment in xss){var alignmentX=xss[alignment][v];posXDebug(alignment,g,v,alignmentX),xs.push(alignmentX)}xs.sort(function(x,y){return x-y}),posX(g,v,(xs[1]+xs[2])/2)});var y=0,reverseY="BT"===g.graph().rankDir||"RL"===g.graph().rankDir;layering.forEach(function(layer){var maxHeight=util.max(layer.map(function(u){return height(g,u)}));y+=maxHeight/2,layer.forEach(function(u){posY(g,u,reverseY?-y:y)}),y+=maxHeight/2+config.rankSep});var minX=util.min(g.nodes().map(function(u){return posX(g,u)-width(g,u)/2})),minY=util.min(g.nodes().map(function(u){return posY(g,u)-height(g,u)/2}));g.eachNode(function(u){posX(g,u,posX(g,u)-minX),posY(g,u,posY(g,u)-minY)})}function undirEdgeId(u,v){return v>u?u.toString().length+":"+u+"-"+v:v.toString().length+":"+v+"-"+u}function findConflicts(g,layering){function updateConflicts(v){var k=pos[v];(k0>k||k>k1)&&(conflicts[undirEdgeId(currLayer[l],v)]=!0)}var prevLayer,currLayer,k0,l,k1,conflicts={},pos={};if(layering.length<=2)return conflicts;layering[1].forEach(function(u,i){pos[u]=i});for(var i=1;i<layering.length-1;++i){prevLayer=layering[i],currLayer=layering[i+1],k0=0,l=0;for(var l1=0;l1<currLayer.length;++l1){var u=currLayer[l1];if(pos[u]=l1,k1=void 0,g.node(u).dummy){var uPred=g.predecessors(u)[0];void 0!==uPred&&g.node(uPred).dummy&&(k1=pos[uPred])}if(void 0===k1&&l1===currLayer.length-1&&(k1=prevLayer.length-1),void 0!==k1){for(;l1>=l;++l)g.predecessors(currLayer[l]).forEach(updateConflicts);k0=k1}}}return conflicts}function verticalAlignment(g,layering,conflicts,relationship){var pos={},root={},align={};return layering.forEach(function(layer){layer.forEach(function(u,i){root[u]=u,align[u]=u,pos[u]=i})}),layering.forEach(function(layer){var prevIdx=-1;layer.forEach(function(v){var mid,related=g[relationship](v);related.length>0&&(related.sort(function(x,y){return pos[x]-pos[y]}),mid=(related.length-1)/2,related.slice(Math.floor(mid),Math.ceil(mid)+1).forEach(function(u){align[v]===v&&!conflicts[undirEdgeId(u,v)]&&prevIdx<pos[u]&&(align[u]=v,align[v]=root[v]=root[u],prevIdx=pos[u])}))})}),{pos:pos,root:root,align:align}}function horizontalCompaction(g,layering,pos,root,align){function updateShift(toShift,neighbor,delta){maybeShift[toShift][neighbor]=neighbor in maybeShift[toShift]?Math.min(maybeShift[toShift][neighbor],delta):delta}function placeBlock(v){if(!(v in xs)){xs[v]=0;var w=v;do{if(pos[w]>0){var u=root[pred[w]];placeBlock(u),sink[v]===v&&(sink[v]=sink[u]);var delta=sep(g,pred[w])+sep(g,w);sink[v]!==sink[u]?updateShift(sink[u],sink[v],xs[v]-xs[u]-delta):xs[v]=Math.max(xs[v],xs[u]+delta)}w=align[w]}while(w!==v)}}var sink={},maybeShift={},shift={},pred={},xs={};return layering.forEach(function(layer){layer.forEach(function(u,i){sink[u]=u,maybeShift[u]={},i>0&&(pred[u]=layer[i-1])})}),util.values(root).forEach(function(v){placeBlock(v)}),layering.forEach(function(layer){layer.forEach(function(v){if(xs[v]=xs[root[v]],v===root[v]&&v===sink[v]){var minShift=0;v in maybeShift&&Object.keys(maybeShift[v]).length>0&&(minShift=util.min(Object.keys(maybeShift[v]).map(function(u){return maybeShift[v][u]+(u in shift?shift[u]:0)}))),shift[v]=minShift}})}),layering.forEach(function(layer){layer.forEach(function(v){xs[v]+=shift[sink[root[v]]]||0})}),xs}function findMinCoord(g,layering,xs){return util.min(layering.map(function(layer){var u=layer[0];return xs[u]}))}function findMaxCoord(g,layering,xs){return util.max(layering.map(function(layer){var u=layer[layer.length-1];return xs[u]}))}function balance(g,layering,xss){function updateAlignment(v){xss[alignment][v]+=shift[alignment]}var smallestAlignment,min={},max={},shift={},smallest=Number.POSITIVE_INFINITY;for(var alignment in xss){var xs=xss[alignment];min[alignment]=findMinCoord(g,layering,xs),max[alignment]=findMaxCoord(g,layering,xs);var w=max[alignment]-min[alignment];smallest>w&&(smallest=w,smallestAlignment=alignment)}["u","d"].forEach(function(vertDir){["l","r"].forEach(function(horizDir){var alignment=vertDir+horizDir;shift[alignment]="l"===horizDir?min[smallestAlignment]-min[alignment]:max[smallestAlignment]-max[alignment]})});for(alignment in xss)g.eachNode(updateAlignment)}function flipHorizontally(xs){for(var u in xs)xs[u]=-xs[u]}function reverseInnerOrder(layering){layering.forEach(function(layer){layer.reverse()})}function width(g,u){switch(g.graph().rankDir){case"LR":return g.node(u).height;case"RL":return g.node(u).height;default:return g.node(u).width}}function height(g,u){switch(g.graph().rankDir){case"LR":return g.node(u).width;case"RL":return g.node(u).width;default:return g.node(u).height}}function sep(g,u){if(null!==config.universalSep)return config.universalSep;var w=width(g,u),s=g.node(u).dummy?config.edgeSep:config.nodeSep;return(w+s)/2}function posX(g,u,x){if("LR"===g.graph().rankDir||"RL"===g.graph().rankDir){if(arguments.length<3)return g.node(u).y;g.node(u).y=x}else{if(arguments.length<3)return g.node(u).x;g.node(u).x=x}}function posXDebug(name,g,u,x){if("LR"===g.graph().rankDir||"RL"===g.graph().rankDir){if(arguments.length<3)return g.node(u)[name];g.node(u)[name]=x}else{if(arguments.length<3)return g.node(u)[name];g.node(u)[name]=x}}function posY(g,u,y){if("LR"===g.graph().rankDir||"RL"===g.graph().rankDir){if(arguments.length<3)return g.node(u).x;g.node(u).x=y}else{if(arguments.length<3)return g.node(u).y;g.node(u).y=y}}function debugPositioning(align,g,layering,xs){layering.forEach(function(l,li){var u,xU;l.forEach(function(v){var xV=xs[v];if(u){var s=sep(g,u)+sep(g,v);s>xV-xU&&console.log("Position phase: sep violation. Align: "+align+". Layer: "+li+". U: "+u+" V: "+v+". Actual sep: "+(xV-xU)+" Expected sep: "+s)}u=v,xU=xV})})}var config={nodeSep:50,edgeSep:10,universalSep:null,rankSep:30},self={};return self.nodeSep=util.propertyAccessor(self,config,"nodeSep"),self.edgeSep=util.propertyAccessor(self,config,"edgeSep"),self.universalSep=util.propertyAccessor(self,config,"universalSep"),self.rankSep=util.propertyAccessor(self,config,"rankSep"),self.debugLevel=util.propertyAccessor(self,config,"debugLevel"),self.run=run,self}},{"./util":18}],11:[function(require,module,exports){function run(g,useSimplex){expandSelfLoops(g),util.time("constraints.apply",constraints.apply)(g),expandSidewaysEdges(g),util.time("acyclic",acyclic)(g);var flatGraph=g.filterNodes(util.filterNonSubgraphs(g));initRank(flatGraph),components(flatGraph).forEach(function(cmpt){var subgraph=flatGraph.filterNodes(filter.nodesFromList(cmpt));rankComponent(subgraph,useSimplex)}),util.time("constraints.relax",constraints.relax(g)),util.time("reorientEdges",reorientEdges)(g)}function restoreEdges(g){acyclic.undo(g)}function expandSelfLoops(g){g.eachEdge(function(e,u,v,a){if(u===v){var x=addDummyNode(g,e,u,v,a,0,!1),y=addDummyNode(g,e,u,v,a,1,!0),z=addDummyNode(g,e,u,v,a,2,!1);g.addEdge(null,x,u,{minLen:1,selfLoop:!0}),g.addEdge(null,x,y,{minLen:1,selfLoop:!0}),g.addEdge(null,u,z,{minLen:1,selfLoop:!0}),g.addEdge(null,y,z,{minLen:1,selfLoop:!0}),g.delEdge(e)}})}function expandSidewaysEdges(g){g.eachEdge(function(e,u,v,a){if(u===v){var origEdge=a.originalEdge,dummy=addDummyNode(g,origEdge.e,origEdge.u,origEdge.v,origEdge.value,0,!0);g.addEdge(null,u,dummy,{minLen:1}),g.addEdge(null,dummy,v,{minLen:1}),g.delEdge(e)}})}function addDummyNode(g,e,u,v,a,index,isLabel){return g.addNode(null,{width:isLabel?a.width:0,height:isLabel?a.height:0,edge:{id:e,source:u,target:v,attrs:a},dummy:!0,index:index})}function reorientEdges(g){g.eachEdge(function(e,u,v,value){g.node(u).rank>g.node(v).rank&&(g.delEdge(e),value.reversed=!0,g.addEdge(e,v,u,value))
})}function rankComponent(subgraph,useSimplex){var spanningTree=feasibleTree(subgraph);useSimplex&&(util.log(1,"Using network simplex for ranking"),simplex(subgraph,spanningTree)),normalize(subgraph)}function normalize(g){var m=util.min(g.nodes().map(function(u){return g.node(u).rank}));g.eachNode(function(u,node){node.rank-=m})}var util=require("./util"),acyclic=require("./rank/acyclic"),initRank=require("./rank/initRank"),feasibleTree=require("./rank/feasibleTree"),constraints=require("./rank/constraints"),simplex=require("./rank/simplex"),components=require("graphlib").alg.components,filter=require("graphlib").filter;exports.run=run,exports.restoreEdges=restoreEdges},{"./rank/acyclic":12,"./rank/constraints":13,"./rank/feasibleTree":14,"./rank/initRank":15,"./rank/simplex":17,"./util":18,graphlib:25}],12:[function(require,module){function acyclic(g){function dfs(u){u in visited||(visited[u]=onStack[u]=!0,g.outEdges(u).forEach(function(e){var value,t=g.target(e);u===t?console.error('Warning: found self loop "'+e+'" for node "'+u+'"'):t in onStack?(value=g.edge(e),g.delEdge(e),value.reversed=!0,++reverseCount,g.addEdge(e,t,u,value)):dfs(t)}),delete onStack[u])}var onStack={},visited={},reverseCount=0;return g.eachNode(function(u){dfs(u)}),util.log(2,"Acyclic Phase: reversed "+reverseCount+" edge(s)"),reverseCount}function undo(g){g.eachEdge(function(e,s,t,a){a.reversed&&(delete a.reversed,g.delEdge(e),g.addEdge(e,t,s,a))})}var util=require("../util");module.exports=acyclic,module.exports.undo=undo},{"../util":18}],13:[function(require,module,exports){function checkSupportedPrefRank(prefRank){return"min"!==prefRank&&"max"!==prefRank&&0!==prefRank.indexOf("same_")?(console.error("Unsupported rank type: "+prefRank),!1):!0}function redirectInEdges(g,u,newU,reverse){g.inEdges(u).forEach(function(e){var value,origValue=g.edge(e);value=origValue.originalEdge?origValue:{originalEdge:{e:e,u:g.source(e),v:g.target(e),value:origValue},minLen:g.edge(e).minLen},origValue.selfLoop&&(reverse=!1),reverse?(g.addEdge(null,newU,g.source(e),value),value.reversed=!0):g.addEdge(null,g.source(e),newU,value)})}function redirectOutEdges(g,u,newU,reverse){g.outEdges(u).forEach(function(e){var value,origValue=g.edge(e);value=origValue.originalEdge?origValue:{originalEdge:{e:e,u:g.source(e),v:g.target(e),value:origValue},minLen:g.edge(e).minLen},origValue.selfLoop&&(reverse=!1),reverse?(g.addEdge(null,g.target(e),newU,value),value.reversed=!0):g.addEdge(null,newU,g.target(e),value)})}function addLightEdgesFromMinNode(g,sg,minNode){void 0!==minNode&&g.children(sg).forEach(function(u){u===minNode||g.outEdges(minNode,u).length||g.node(u).dummy||g.addEdge(null,minNode,u,{minLen:0})})}function addLightEdgesToMaxNode(g,sg,maxNode){void 0!==maxNode&&g.children(sg).forEach(function(u){u===maxNode||g.outEdges(u,maxNode).length||g.node(u).dummy||g.addEdge(null,u,maxNode,{minLen:0})})}exports.apply=function(g){function dfs(sg){var rankSets={};g.children(sg).forEach(function(u){if(g.children(u).length)return void dfs(u);var value=g.node(u),prefRank=value.prefRank;if(void 0!==prefRank){if(!checkSupportedPrefRank(prefRank))return;prefRank in rankSets?rankSets.prefRank.push(u):rankSets.prefRank=[u];var newU=rankSets[prefRank];void 0===newU&&(newU=rankSets[prefRank]=g.addNode(null,{originalNodes:[]}),g.parent(newU,sg)),redirectInEdges(g,u,newU,"min"===prefRank),redirectOutEdges(g,u,newU,"max"===prefRank),g.node(newU).originalNodes.push({u:u,value:value,parent:sg}),g.delNode(u)}}),addLightEdgesFromMinNode(g,sg,rankSets.min),addLightEdgesToMaxNode(g,sg,rankSets.max)}dfs(null)},exports.relax=function(g){var originalEdges=[];g.eachEdge(function(e,u,v,value){var originalEdge=value.originalEdge;originalEdge&&originalEdges.push(originalEdge)}),g.eachNode(function(u,value){var originalNodes=value.originalNodes;originalNodes&&(originalNodes.forEach(function(originalNode){originalNode.value.rank=value.rank,g.addNode(originalNode.u,originalNode.value),g.parent(originalNode.u,originalNode.parent)}),g.delNode(u))}),originalEdges.forEach(function(edge){g.addEdge(edge.e,edge.u,edge.v,edge.value)})}},{}],14:[function(require,module){function feasibleTree(g){function addTightEdges(v){var continueToScan=!0;return g.predecessors(v).forEach(function(u){remaining.has(u)&&!slack(g,u,v)&&(remaining.has(v)&&(tree.addNode(v,{}),remaining.remove(v),tree.graph({root:v})),tree.addNode(u,{}),tree.addEdge(null,u,v,{reversed:!0}),remaining.remove(u),addTightEdges(u),continueToScan=!1)}),g.successors(v).forEach(function(w){remaining.has(w)&&!slack(g,v,w)&&(remaining.has(v)&&(tree.addNode(v,{}),remaining.remove(v),tree.graph({root:v})),tree.addNode(w,{}),tree.addEdge(null,v,w,{}),remaining.remove(w),addTightEdges(w),continueToScan=!1)}),continueToScan}function createTightEdge(){var minSlack=Number.MAX_VALUE;remaining.keys().forEach(function(v){g.predecessors(v).forEach(function(u){if(!remaining.has(u)){var edgeSlack=slack(g,u,v);Math.abs(edgeSlack)<Math.abs(minSlack)&&(minSlack=-edgeSlack)}}),g.successors(v).forEach(function(w){if(!remaining.has(w)){var edgeSlack=slack(g,v,w);Math.abs(edgeSlack)<Math.abs(minSlack)&&(minSlack=edgeSlack)}})}),tree.eachNode(function(u){g.node(u).rank-=minSlack})}var remaining=new Set(g.nodes()),tree=new Digraph;if(1===remaining.size()){var root=g.nodes()[0];return tree.addNode(root,{}),tree.graph({root:root}),tree}for(;remaining.size();){for(var nodesToSearch=tree.order()?tree.nodes():remaining.keys(),i=0,il=nodesToSearch.length;il>i&&addTightEdges(nodesToSearch[i]);++i);remaining.size()&&createTightEdge()}return tree}function slack(g,u,v){var rankDiff=g.node(v).rank-g.node(u).rank,maxMinLen=util.max(g.outEdges(u,v).map(function(e){return g.edge(e).minLen}));return rankDiff-maxMinLen}var Set=require("cp-data").Set,Digraph=require("graphlib").Digraph,util=require("../util");module.exports=feasibleTree},{"../util":18,"cp-data":20,graphlib:25}],15:[function(require,module){function initRank(g){var sorted=topsort(g);sorted.forEach(function(u){var inEdges=g.inEdges(u);if(0===inEdges.length)return void(g.node(u).rank=0);var minLens=inEdges.map(function(e){return g.node(g.source(e)).rank+g.edge(e).minLen});g.node(u).rank=util.max(minLens)})}var util=require("../util"),topsort=require("graphlib").alg.topsort;module.exports=initRank},{"../util":18,graphlib:25}],16:[function(require,module){function slack(graph,u,v,minLen){return Math.abs(graph.node(u).rank-graph.node(v).rank)-minLen}module.exports={slack:slack}},{}],17:[function(require,module){function simplex(graph,spanningTree){for(initCutValues(graph,spanningTree);;){var e=leaveEdge(spanningTree);if(null===e)break;var f=enterEdge(graph,spanningTree,e);exchange(graph,spanningTree,e,f)}}function initCutValues(graph,spanningTree){function dfs(n){var children=spanningTree.successors(n);for(var c in children){var child=children[c];dfs(child)}n!==spanningTree.graph().root&&setCutValue(graph,spanningTree,n)}computeLowLim(spanningTree),spanningTree.eachEdge(function(id,u,v,treeValue){treeValue.cutValue=0}),dfs(spanningTree.graph().root)}function computeLowLim(tree){function dfs(n){var children=tree.successors(n),low=postOrderNum;for(var c in children){var child=children[c];dfs(child),low=Math.min(low,tree.node(child).low)}tree.node(n).low=low,tree.node(n).lim=postOrderNum++}var postOrderNum=0;dfs(tree.graph().root)}function setCutValue(graph,tree,child){var parentEdge=tree.inEdges(child)[0],grandchildren=[],grandchildEdges=tree.outEdges(child);for(var gce in grandchildEdges)grandchildren.push(tree.target(grandchildEdges[gce]));var gc,cutValue=0,E=0,F=0,G=0,H=0,outEdges=graph.outEdges(child);for(var oe in outEdges){var succ=graph.target(outEdges[oe]);for(gc in grandchildren)inSubtree(tree,succ,grandchildren[gc])&&E++;inSubtree(tree,succ,child)||G++}var inEdges=graph.inEdges(child);for(var ie in inEdges){var pred=graph.source(inEdges[ie]);for(gc in grandchildren)inSubtree(tree,pred,grandchildren[gc])&&F++;inSubtree(tree,pred,child)||H++}var grandchildCutSum=0;for(gc in grandchildren){var cv=tree.edge(grandchildEdges[gc]).cutValue;tree.edge(grandchildEdges[gc]).reversed?grandchildCutSum-=cv:grandchildCutSum+=cv}tree.edge(parentEdge).reversed?cutValue-=grandchildCutSum-E+F-G+H:cutValue+=grandchildCutSum-E+F-G+H,tree.edge(parentEdge).cutValue=cutValue}function inSubtree(tree,n,root){return tree.node(root).low<=tree.node(n).lim&&tree.node(n).lim<=tree.node(root).lim}function leaveEdge(tree){var edges=tree.edges();for(var n in edges){var e=edges[n],treeValue=tree.edge(e);if(treeValue.cutValue<0)return e}return null}function enterEdge(graph,tree,e){var minSlackEdge,source=tree.source(e),target=tree.target(e),lower=tree.node(target).lim<tree.node(source).lim?target:source,aligned=!tree.edge(e).reversed,minSlack=Number.POSITIVE_INFINITY;if(graph.eachEdge(aligned?function(id,u,v,value){if(id!==e&&inSubtree(tree,u,lower)&&!inSubtree(tree,v,lower)){var slack=rankUtil.slack(graph,u,v,value.minLen);minSlack>slack&&(minSlack=slack,minSlackEdge=id)}}:function(id,u,v,value){if(id!==e&&!inSubtree(tree,u,lower)&&inSubtree(tree,v,lower)){var slack=rankUtil.slack(graph,u,v,value.minLen);minSlack>slack&&(minSlack=slack,minSlackEdge=id)}}),void 0===minSlackEdge){var outside=[],inside=[];throw graph.eachNode(function(id){inSubtree(tree,id,lower)?inside.push(id):outside.push(id)}),new Error("No edge found from outside of tree to inside")}return minSlackEdge}function exchange(graph,tree,e,f){function redirect(v){var edges=tree.inEdges(v);for(var i in edges){var e=edges[i],u=tree.source(e),value=tree.edge(e);redirect(u),tree.delEdge(e),value.reversed=!value.reversed,tree.addEdge(e,v,u,value)}}tree.delEdge(e);var source=graph.source(f),target=graph.target(f);redirect(target);for(var root=source,edges=tree.inEdges(root);edges.length>0;)root=tree.source(edges[0]),edges=tree.inEdges(root);tree.graph().root=root,tree.addEdge(null,source,target,{cutValue:0}),initCutValues(graph,tree),adjustRanks(graph,tree)}function adjustRanks(graph,tree){function dfs(p){var children=tree.successors(p);children.forEach(function(c){var minLen=minimumLength(graph,p,c);graph.node(c).rank=graph.node(p).rank+minLen,dfs(c)})}dfs(tree.graph().root)}function minimumLength(graph,u,v){var outEdges=graph.outEdges(u,v);if(outEdges.length>0)return util.max(outEdges.map(function(e){return graph.edge(e).minLen}));var inEdges=graph.inEdges(u,v);return inEdges.length>0?-util.max(inEdges.map(function(e){return graph.edge(e).minLen})):void 0}var util=require("../util"),rankUtil=require("./rankUtil");module.exports=simplex},{"../util":18,"./rankUtil":16}],18:[function(require,module,exports){function time(name,func){return function(){var start=(new Date).getTime();try{return func.apply(null,arguments)}finally{log(1,name+" time: "+((new Date).getTime()-start)+"ms")}}}function log(level){log.level>=level&&console.log.apply(console,Array.prototype.slice.call(arguments,1))}exports.min=function(values){return Math.min.apply(Math,values)},exports.max=function(values){return Math.max.apply(Math,values)},exports.all=function(xs,f){for(var i=0;i<xs.length;++i)if(!f(xs[i]))return!1;return!0},exports.sum=function(values){return values.reduce(function(acc,x){return acc+x},0)},exports.values=function(obj){return Object.keys(obj).map(function(k){return obj[k]})},exports.shuffle=function(array){for(var i=array.length-1;i>0;--i){var j=Math.floor(Math.random()*(i+1)),aj=array[j];array[j]=array[i],array[i]=aj}},exports.propertyAccessor=function(self,config,field,setHook){return function(x){return arguments.length?(config[field]=x,setHook&&setHook(x),self):config[field]}},exports.ordering=function(g){var ordering=[];return g.eachNode(function(u,value){var rank=ordering[value.rank]||(ordering[value.rank]=[]);rank[value.order]=u}),ordering},exports.filterNonSubgraphs=function(g){return function(u){return 0===g.children(u).length}},time.enabled=!1,exports.time=time,log.level=0,exports.log=log},{}],19:[function(require,module){module.exports="0.4.6"},{}],20:[function(require,module,exports){exports.Set=require("./lib/Set"),exports.PriorityQueue=require("./lib/PriorityQueue"),exports.version=require("./lib/version")},{"./lib/PriorityQueue":21,"./lib/Set":22,"./lib/version":24}],21:[function(require,module){function PriorityQueue(){this._arr=[],this._keyIndices={}}module.exports=PriorityQueue,PriorityQueue.prototype.size=function(){return this._arr.length},PriorityQueue.prototype.keys=function(){return this._arr.map(function(x){return x.key})},PriorityQueue.prototype.has=function(key){return key in this._keyIndices},PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];return void 0!==index?this._arr[index].priority:void 0},PriorityQueue.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;if(!(key in keyIndices)){var arr=this._arr,index=arr.length;return keyIndices[key]=index,arr.push({key:key,priority:priority}),this._decrease(index),!0}return!1},PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();return delete this._keyIndices[min.key],this._heapify(0),min.key},PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority)throw new Error("New priority is greater than current priority. Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority);this._arr[index].priority=priority,this._decrease(index)},PriorityQueue.prototype._heapify=function(i){var arr=this._arr,l=2*i,r=l+1,largest=i;l<arr.length&&(largest=arr[l].priority<arr[largest].priority?l:largest,r<arr.length&&(largest=arr[r].priority<arr[largest].priority?r:largest),largest!==i&&(this._swap(i,largest),this._heapify(largest)))},PriorityQueue.prototype._decrease=function(index){for(var parent,arr=this._arr,priority=arr[index].priority;0!==index&&(parent=index>>1,!(arr[parent].priority<priority));)this._swap(index,parent),index=parent},PriorityQueue.prototype._swap=function(i,j){var arr=this._arr,keyIndices=this._keyIndices,origArrI=arr[i],origArrJ=arr[j];arr[i]=origArrJ,arr[j]=origArrI,keyIndices[origArrJ.key]=i,keyIndices[origArrI.key]=j}},{}],22:[function(require,module){function Set(initialKeys){if(this._size=0,this._keys={},initialKeys)for(var i=0,il=initialKeys.length;il>i;++i)this.add(initialKeys[i])}function values(o){var i,ks=Object.keys(o),len=ks.length,result=new Array(len);for(i=0;len>i;++i)result[i]=o[ks[i]];return result}var util=require("./util");module.exports=Set,Set.intersect=function(sets){if(0===sets.length)return new Set;for(var result=new Set(util.isArray(sets[0])?sets[0]:sets[0].keys()),i=1,il=sets.length;il>i;++i)for(var resultKeys=result.keys(),other=util.isArray(sets[i])?new Set(sets[i]):sets[i],j=0,jl=resultKeys.length;jl>j;++j){var key=resultKeys[j];other.has(key)||result.remove(key)}return result},Set.union=function(sets){for(var totalElems=util.reduce(sets,function(lhs,rhs){return lhs+(rhs.size?rhs.size():rhs.length)},0),arr=new Array(totalElems),k=0,i=0,il=sets.length;il>i;++i)for(var cur=sets[i],keys=util.isArray(cur)?cur:cur.keys(),j=0,jl=keys.length;jl>j;++j)arr[k++]=keys[j];return new Set(arr)},Set.prototype.size=function(){return this._size},Set.prototype.keys=function(){return values(this._keys)},Set.prototype.has=function(key){return key in this._keys},Set.prototype.add=function(key){return key in this._keys?!1:(this._keys[key]=key,++this._size,!0)},Set.prototype.remove=function(key){return key in this._keys?(delete this._keys[key],--this._size,!0):!1}},{"./util":23}],23:[function(require,module,exports){exports.isArray=Array.isArray?Array.isArray:function(vArg){return"[object Array]"===Object.prototype.toString.call(vArg)},exports.reduce="function"!=typeof Array.prototype.reduce?function(array,callback,opt_initialValue){if(null===array||"undefined"==typeof array)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");var index,value,length=array.length>>>0,isValueSet=!1;for(1<arguments.length&&(value=opt_initialValue,isValueSet=!0),index=0;length>index;++index)array.hasOwnProperty(index)&&(isValueSet?value=callback(value,array[index],index,array):(value=array[index],isValueSet=!0));if(!isValueSet)throw new TypeError("Reduce of empty array with no initial value");return value}:function(array,callback,opt_initialValue){return array.reduce(callback,opt_initialValue)}},{}],24:[function(require,module){module.exports="1.1.3"},{}],25:[function(require,module,exports){exports.Graph=require("./lib/Graph"),exports.Digraph=require("./lib/Digraph"),exports.CGraph=require("./lib/CGraph"),exports.CDigraph=require("./lib/CDigraph"),require("./lib/graph-converters"),exports.alg={isAcyclic:require("./lib/alg/isAcyclic"),components:require("./lib/alg/components"),dijkstra:require("./lib/alg/dijkstra"),dijkstraAll:require("./lib/alg/dijkstraAll"),findCycles:require("./lib/alg/findCycles"),floydWarshall:require("./lib/alg/floydWarshall"),postorder:require("./lib/alg/postorder"),preorder:require("./lib/alg/preorder"),prim:require("./lib/alg/prim"),tarjan:require("./lib/alg/tarjan"),topsort:require("./lib/alg/topsort")},exports.converter={json:require("./lib/converter/json.js")};var filter=require("./lib/filter");exports.filter={all:filter.all,nodesFromList:filter.nodesFromList},exports.version=require("./lib/version")},{"./lib/CDigraph":27,"./lib/CGraph":28,"./lib/Digraph":29,"./lib/Graph":30,"./lib/alg/components":31,"./lib/alg/dijkstra":32,"./lib/alg/dijkstraAll":33,"./lib/alg/findCycles":34,"./lib/alg/floydWarshall":35,"./lib/alg/isAcyclic":36,"./lib/alg/postorder":37,"./lib/alg/preorder":38,"./lib/alg/prim":39,"./lib/alg/tarjan":40,"./lib/alg/topsort":41,"./lib/converter/json.js":43,"./lib/filter":44,"./lib/graph-converters":45,"./lib/version":47}],26:[function(require,module){function BaseGraph(){this._value=void 0,this._nodes={},this._edges={},this._nextId=0}function addEdgeToMap(map,v,e){(map[v]||(map[v]=new Set)).add(e)}function delEdgeFromMap(map,v,e){var vEntry=map[v];vEntry.remove(e),0===vEntry.size()&&delete map[v]}var Set=require("cp-data").Set;module.exports=BaseGraph,BaseGraph.prototype.order=function(){return Object.keys(this._nodes).length},BaseGraph.prototype.size=function(){return Object.keys(this._edges).length},BaseGraph.prototype.graph=function(value){return 0===arguments.length?this._value:void(this._value=value)},BaseGraph.prototype.hasNode=function(u){return u in this._nodes},BaseGraph.prototype.node=function(u,value){var node=this._strictGetNode(u);return 1===arguments.length?node.value:void(node.value=value)},BaseGraph.prototype.nodes=function(){var nodes=[];return this.eachNode(function(id){nodes.push(id)}),nodes},BaseGraph.prototype.eachNode=function(func){for(var k in this._nodes){var node=this._nodes[k];func(node.id,node.value)}},BaseGraph.prototype.hasEdge=function(e){return e in this._edges},BaseGraph.prototype.edge=function(e,value){var edge=this._strictGetEdge(e);return 1===arguments.length?edge.value:void(edge.value=value)},BaseGraph.prototype.edges=function(){var es=[];return this.eachEdge(function(id){es.push(id)}),es},BaseGraph.prototype.eachEdge=function(func){for(var k in this._edges){var edge=this._edges[k];func(edge.id,edge.u,edge.v,edge.value)}},BaseGraph.prototype.incidentNodes=function(e){var edge=this._strictGetEdge(e);return[edge.u,edge.v]},BaseGraph.prototype.addNode=function(u,value){if(void 0===u||null===u){do u="_"+ ++this._nextId;while(this.hasNode(u))}else if(this.hasNode(u))throw new Error("Graph already has node '"+u+"'");return this._nodes[u]={id:u,value:value},u},BaseGraph.prototype.delNode=function(u){this._strictGetNode(u),this.incidentEdges(u).forEach(function(e){this.delEdge(e)},this),delete this._nodes[u]},BaseGraph.prototype._addEdge=function(e,u,v,value,inMap,outMap){if(this._strictGetNode(u),this._strictGetNode(v),void 0===e||null===e){do e="_"+ ++this._nextId;while(this.hasEdge(e))}else if(this.hasEdge(e))throw new Error("Graph already has edge '"+e+"'");return this._edges[e]={id:e,u:u,v:v,value:value},addEdgeToMap(inMap[v],u,e),addEdgeToMap(outMap[u],v,e),e},BaseGraph.prototype._delEdge=function(e,inMap,outMap){var edge=this._strictGetEdge(e);delEdgeFromMap(inMap[edge.v],edge.u,e),delEdgeFromMap(outMap[edge.u],edge.v,e),delete this._edges[e]},BaseGraph.prototype.copy=function(){var copy=new this.constructor;return copy.graph(this.graph()),this.eachNode(function(u,value){copy.addNode(u,value)}),this.eachEdge(function(e,u,v,value){copy.addEdge(e,u,v,value)}),copy._nextId=this._nextId,copy},BaseGraph.prototype.filterNodes=function(filter){var copy=new this.constructor;return copy.graph(this.graph()),this.eachNode(function(u,value){filter(u)&&copy.addNode(u,value)}),this.eachEdge(function(e,u,v,value){copy.hasNode(u)&&copy.hasNode(v)&&copy.addEdge(e,u,v,value)}),copy},BaseGraph.prototype._strictGetNode=function(u){var node=this._nodes[u];if(void 0===node)throw new Error("Node '"+u+"' is not in graph");return node},BaseGraph.prototype._strictGetEdge=function(e){var edge=this._edges[e];if(void 0===edge)throw new Error("Edge '"+e+"' is not in graph");return edge}},{"cp-data":20}],27:[function(require,module){var Digraph=require("./Digraph"),compoundify=require("./compoundify"),CDigraph=compoundify(Digraph);module.exports=CDigraph,CDigraph.fromDigraph=function(src){var g=new CDigraph,graphValue=src.graph();return void 0!==graphValue&&g.graph(graphValue),src.eachNode(function(u,value){void 0===value?g.addNode(u):g.addNode(u,value)}),src.eachEdge(function(e,u,v,value){void 0===value?g.addEdge(null,u,v):g.addEdge(null,u,v,value)}),g},CDigraph.prototype.toString=function(){return"CDigraph "+JSON.stringify(this,null,2)}},{"./Digraph":29,"./compoundify":42}],28:[function(require,module){var Graph=require("./Graph"),compoundify=require("./compoundify"),CGraph=compoundify(Graph);module.exports=CGraph,CGraph.fromGraph=function(src){var g=new CGraph,graphValue=src.graph();return void 0!==graphValue&&g.graph(graphValue),src.eachNode(function(u,value){void 0===value?g.addNode(u):g.addNode(u,value)}),src.eachEdge(function(e,u,v,value){void 0===value?g.addEdge(null,u,v):g.addEdge(null,u,v,value)}),g},CGraph.prototype.toString=function(){return"CGraph "+JSON.stringify(this,null,2)}},{"./Graph":30,"./compoundify":42}],29:[function(require,module){function Digraph(){BaseGraph.call(this),this._inEdges={},this._outEdges={}}var util=require("./util"),BaseGraph=require("./BaseGraph"),Set=require("cp-data").Set;module.exports=Digraph,Digraph.prototype=new BaseGraph,Digraph.prototype.constructor=Digraph,Digraph.prototype.isDirected=function(){return!0},Digraph.prototype.successors=function(u){return this._strictGetNode(u),Object.keys(this._outEdges[u]).map(function(v){return this._nodes[v].id},this)},Digraph.prototype.predecessors=function(u){return this._strictGetNode(u),Object.keys(this._inEdges[u]).map(function(v){return this._nodes[v].id},this)},Digraph.prototype.neighbors=function(u){return Set.union([this.successors(u),this.predecessors(u)]).keys()},Digraph.prototype.sources=function(){var self=this;return this._filterNodes(function(u){return 0===self.inEdges(u).length})},Digraph.prototype.sinks=function(){var self=this;return this._filterNodes(function(u){return 0===self.outEdges(u).length})},Digraph.prototype.source=function(e){return this._strictGetEdge(e).u},Digraph.prototype.target=function(e){return this._strictGetEdge(e).v},Digraph.prototype.inEdges=function(target,source){this._strictGetNode(target);var results=Set.union(util.values(this._inEdges[target])).keys();return arguments.length>1&&(this._strictGetNode(source),results=results.filter(function(e){return this.source(e)===source},this)),results},Digraph.prototype.outEdges=function(source,target){this._strictGetNode(source);var results=Set.union(util.values(this._outEdges[source])).keys();return arguments.length>1&&(this._strictGetNode(target),results=results.filter(function(e){return this.target(e)===target},this)),results},Digraph.prototype.incidentEdges=function(u,v){return arguments.length>1?Set.union([this.outEdges(u,v),this.outEdges(v,u)]).keys():Set.union([this.inEdges(u),this.outEdges(u)]).keys()},Digraph.prototype.toString=function(){return"Digraph "+JSON.stringify(this,null,2)},Digraph.prototype.addNode=function(u,value){return u=BaseGraph.prototype.addNode.call(this,u,value),this._inEdges[u]={},this._outEdges[u]={},u},Digraph.prototype.delNode=function(u){BaseGraph.prototype.delNode.call(this,u),delete this._inEdges[u],delete this._outEdges[u]},Digraph.prototype.addEdge=function(e,source,target,value){return BaseGraph.prototype._addEdge.call(this,e,source,target,value,this._inEdges,this._outEdges)},Digraph.prototype.delEdge=function(e){BaseGraph.prototype._delEdge.call(this,e,this._inEdges,this._outEdges)},Digraph.prototype._filterNodes=function(pred){var filtered=[];return this.eachNode(function(u){pred(u)&&filtered.push(u)}),filtered}},{"./BaseGraph":26,"./util":46,"cp-data":20}],30:[function(require,module){function Graph(){BaseGraph.call(this),this._incidentEdges={}}var util=require("./util"),BaseGraph=require("./BaseGraph"),Set=require("cp-data").Set;module.exports=Graph,Graph.prototype=new BaseGraph,Graph.prototype.constructor=Graph,Graph.prototype.isDirected=function(){return!1},Graph.prototype.neighbors=function(u){return this._strictGetNode(u),Object.keys(this._incidentEdges[u]).map(function(v){return this._nodes[v].id},this)},Graph.prototype.incidentEdges=function(u,v){return this._strictGetNode(u),arguments.length>1?(this._strictGetNode(v),v in this._incidentEdges[u]?this._incidentEdges[u][v].keys():[]):Set.union(util.values(this._incidentEdges[u])).keys()},Graph.prototype.toString=function(){return"Graph "+JSON.stringify(this,null,2)},Graph.prototype.addNode=function(u,value){return u=BaseGraph.prototype.addNode.call(this,u,value),this._incidentEdges[u]={},u},Graph.prototype.delNode=function(u){BaseGraph.prototype.delNode.call(this,u),delete this._incidentEdges[u]},Graph.prototype.addEdge=function(e,u,v,value){return BaseGraph.prototype._addEdge.call(this,e,u,v,value,this._incidentEdges,this._incidentEdges)},Graph.prototype.delEdge=function(e){BaseGraph.prototype._delEdge.call(this,e,this._incidentEdges,this._incidentEdges)}},{"./BaseGraph":26,"./util":46,"cp-data":20}],31:[function(require,module){function components(g){function dfs(v,component){visited.has(v)||(visited.add(v),component.push(v),g.neighbors(v).forEach(function(w){dfs(w,component)}))}var results=[],visited=new Set;return g.nodes().forEach(function(v){var component=[];dfs(v,component),component.length>0&&results.push(component)}),results}var Set=require("cp-data").Set;module.exports=components},{"cp-data":20}],32:[function(require,module){function dijkstra(g,source,weightFunc,incidentFunc){function updateNeighbors(e){var incidentNodes=g.incidentNodes(e),v=incidentNodes[0]!==u?incidentNodes[0]:incidentNodes[1],vEntry=results[v],weight=weightFunc(e),distance=uEntry.distance+weight;if(0>weight)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+weight);distance<vEntry.distance&&(vEntry.distance=distance,vEntry.predecessor=u,pq.decrease(v,distance))}var results={},pq=new PriorityQueue;weightFunc=weightFunc||function(){return 1},incidentFunc=incidentFunc||(g.isDirected()?function(u){return g.outEdges(u)}:function(u){return g.incidentEdges(u)}),g.eachNode(function(u){var distance=u===source?0:Number.POSITIVE_INFINITY;results[u]={distance:distance},pq.add(u,distance)});for(var u,uEntry;pq.size()>0&&(u=pq.removeMin(),uEntry=results[u],uEntry.distance!==Number.POSITIVE_INFINITY);)incidentFunc(u).forEach(updateNeighbors);return results}var PriorityQueue=require("cp-data").PriorityQueue;module.exports=dijkstra},{"cp-data":20}],33:[function(require,module){function dijkstraAll(g,weightFunc,incidentFunc){var results={};return g.eachNode(function(u){results[u]=dijkstra(g,u,weightFunc,incidentFunc)}),results}var dijkstra=require("./dijkstra");module.exports=dijkstraAll},{"./dijkstra":32}],34:[function(require,module){function findCycles(g){return tarjan(g).filter(function(cmpt){return cmpt.length>1})}var tarjan=require("./tarjan");module.exports=findCycles},{"./tarjan":40}],35:[function(require,module){function floydWarshall(g,weightFunc,incidentFunc){var results={},nodes=g.nodes();return weightFunc=weightFunc||function(){return 1},incidentFunc=incidentFunc||(g.isDirected()?function(u){return g.outEdges(u)}:function(u){return g.incidentEdges(u)}),nodes.forEach(function(u){results[u]={},results[u][u]={distance:0},nodes.forEach(function(v){u!==v&&(results[u][v]={distance:Number.POSITIVE_INFINITY})}),incidentFunc(u).forEach(function(e){var incidentNodes=g.incidentNodes(e),v=incidentNodes[0]!==u?incidentNodes[0]:incidentNodes[1],d=weightFunc(e);d<results[u][v].distance&&(results[u][v]={distance:d,predecessor:u})})}),nodes.forEach(function(k){var rowK=results[k];nodes.forEach(function(i){var rowI=results[i];nodes.forEach(function(j){var ik=rowI[k],kj=rowK[j],ij=rowI[j],altDistance=ik.distance+kj.distance;altDistance<ij.distance&&(ij.distance=altDistance,ij.predecessor=kj.predecessor)})})}),results}module.exports=floydWarshall},{}],36:[function(require,module){function isAcyclic(g){try{topsort(g)}catch(e){if(e instanceof topsort.CycleException)return!1;throw e}return!0}var topsort=require("./topsort");module.exports=isAcyclic},{"./topsort":41}],37:[function(require,module){function postorder(g,root,f){function dfs(u,prev){if(visited.has(u))throw new Error("The input graph is not a tree: "+g);visited.add(u),g.neighbors(u).forEach(function(v){v!==prev&&dfs(v,u)}),f(u)}var visited=new Set;if(g.isDirected())throw new Error("This function only works for undirected graphs");dfs(root)}var Set=require("cp-data").Set;module.exports=postorder},{"cp-data":20}],38:[function(require,module){function preorder(g,root,f){function dfs(u,prev){if(visited.has(u))throw new Error("The input graph is not a tree: "+g);visited.add(u),f(u),g.neighbors(u).forEach(function(v){v!==prev&&dfs(v,u)})}var visited=new Set;if(g.isDirected())throw new Error("This function only works for undirected graphs");dfs(root)}var Set=require("cp-data").Set;module.exports=preorder},{"cp-data":20}],39:[function(require,module){function prim(g,weightFunc){function updateNeighbors(e){var incidentNodes=g.incidentNodes(e),v=incidentNodes[0]!==u?incidentNodes[0]:incidentNodes[1],pri=pq.priority(v);if(void 0!==pri){var edgeWeight=weightFunc(e);pri>edgeWeight&&(parents[v]=u,pq.decrease(v,edgeWeight))}}var u,result=new Graph,parents={},pq=new PriorityQueue;if(0===g.order())return result;g.eachNode(function(u){pq.add(u,Number.POSITIVE_INFINITY),result.addNode(u)}),pq.decrease(g.nodes()[0],0);for(var init=!1;pq.size()>0;){if(u=pq.removeMin(),u in parents)result.addEdge(null,u,parents[u]);else{if(init)throw new Error("Input graph is not connected: "+g);init=!0}g.incidentEdges(u).forEach(updateNeighbors)}return result}var Graph=require("../Graph"),PriorityQueue=require("cp-data").PriorityQueue;module.exports=prim},{"../Graph":30,"cp-data":20}],40:[function(require,module){function tarjan(g){function dfs(u){var entry=visited[u]={onStack:!0,lowlink:index,index:index++};if(stack.push(u),g.successors(u).forEach(function(v){v in visited?visited[v].onStack&&(entry.lowlink=Math.min(entry.lowlink,visited[v].index)):(dfs(v),entry.lowlink=Math.min(entry.lowlink,visited[v].lowlink))}),entry.lowlink===entry.index){var v,cmpt=[];do v=stack.pop(),visited[v].onStack=!1,cmpt.push(v);while(u!==v);results.push(cmpt)}}if(!g.isDirected())throw new Error("tarjan can only be applied to a directed graph. Bad input: "+g);var index=0,stack=[],visited={},results=[];return g.nodes().forEach(function(u){u in visited||dfs(u)}),results}module.exports=tarjan},{}],41:[function(require,module){function topsort(g){function visit(node){if(node in stack)throw new CycleException;
node in visited||(stack[node]=!0,visited[node]=!0,g.predecessors(node).forEach(function(pred){visit(pred)}),delete stack[node],results.push(node))}if(!g.isDirected())throw new Error("topsort can only be applied to a directed graph. Bad input: "+g);var visited={},stack={},results=[],sinks=g.sinks();if(0!==g.order()&&0===sinks.length)throw new CycleException;return g.sinks().forEach(function(sink){visit(sink)}),results}function CycleException(){}module.exports=topsort,topsort.CycleException=CycleException,CycleException.prototype.toString=function(){return"Graph has at least one cycle"}},{}],42:[function(require,module){function compoundify(SuperConstructor){function Constructor(){SuperConstructor.call(this),this._parents={},this._children={},this._children[null]=new Set}return Constructor.prototype=new SuperConstructor,Constructor.prototype.constructor=Constructor,Constructor.prototype.parent=function(u,parent){if(this._strictGetNode(u),arguments.length<2)return this._parents[u];if(u===parent)throw new Error("Cannot make "+u+" a parent of itself");null!==parent&&this._strictGetNode(parent),this._children[this._parents[u]].remove(u),this._parents[u]=parent,this._children[parent].add(u)},Constructor.prototype.children=function(u){return null!==u&&this._strictGetNode(u),this._children[u].keys()},Constructor.prototype.addNode=function(u,value){return u=SuperConstructor.prototype.addNode.call(this,u,value),this._parents[u]=null,this._children[u]=new Set,this._children[null].add(u),u},Constructor.prototype.delNode=function(u){var parent=this.parent(u);return this._children[u].keys().forEach(function(child){this.parent(child,parent)},this),this._children[parent].remove(u),delete this._parents[u],delete this._children[u],SuperConstructor.prototype.delNode.call(this,u)},Constructor.prototype.copy=function(){var copy=SuperConstructor.prototype.copy.call(this);return this.nodes().forEach(function(u){copy.parent(u,this.parent(u))},this),copy},Constructor.prototype.filterNodes=function(filter){function findParent(u){var parent=self.parent(u);return null===parent||copy.hasNode(parent)?(parents[u]=parent,parent):parent in parents?parents[parent]:findParent(parent)}var self=this,copy=SuperConstructor.prototype.filterNodes.call(this,filter),parents={};return copy.eachNode(function(u){copy.parent(u,findParent(u))}),copy},Constructor}var Set=require("cp-data").Set;module.exports=compoundify},{"cp-data":20}],43:[function(require,module,exports){function typeOf(obj){return Object.prototype.toString.call(obj).slice(8,-1)}var Graph=require("../Graph"),Digraph=require("../Digraph"),CGraph=require("../CGraph"),CDigraph=require("../CDigraph");exports.decode=function(nodes,edges,Ctor){if(Ctor=Ctor||Digraph,"Array"!==typeOf(nodes))throw new Error("nodes is not an Array");if("Array"!==typeOf(edges))throw new Error("edges is not an Array");if("string"==typeof Ctor)switch(Ctor){case"graph":Ctor=Graph;break;case"digraph":Ctor=Digraph;break;case"cgraph":Ctor=CGraph;break;case"cdigraph":Ctor=CDigraph;break;default:throw new Error("Unrecognized graph type: "+Ctor)}var graph=new Ctor;return nodes.forEach(function(u){graph.addNode(u.id,u.value)}),graph.parent&&nodes.forEach(function(u){u.children&&u.children.forEach(function(v){graph.parent(v,u.id)})}),edges.forEach(function(e){graph.addEdge(e.id,e.u,e.v,e.value)}),graph},exports.encode=function(graph){var nodes=[],edges=[];graph.eachNode(function(u,value){var node={id:u,value:value};if(graph.children){var children=graph.children(u);children.length&&(node.children=children)}nodes.push(node)}),graph.eachEdge(function(e,u,v,value){edges.push({id:e,u:u,v:v,value:value})});var type;if(graph instanceof CDigraph)type="cdigraph";else if(graph instanceof CGraph)type="cgraph";else if(graph instanceof Digraph)type="digraph";else{if(!(graph instanceof Graph))throw new Error("Couldn't determine type of graph: "+graph);type="graph"}return{nodes:nodes,edges:edges,type:type}}},{"../CDigraph":27,"../CGraph":28,"../Digraph":29,"../Graph":30}],44:[function(require,module,exports){var Set=require("cp-data").Set;exports.all=function(){return function(){return!0}},exports.nodesFromList=function(nodes){var set=new Set(nodes);return function(u){return set.has(u)}}},{"cp-data":20}],45:[function(require){var Graph=require("./Graph"),Digraph=require("./Digraph");Graph.prototype.toDigraph=Graph.prototype.asDirected=function(){var g=new Digraph;return this.eachNode(function(u,value){g.addNode(u,value)}),this.eachEdge(function(e,u,v,value){g.addEdge(null,u,v,value),g.addEdge(null,v,u,value)}),g},Digraph.prototype.toGraph=Digraph.prototype.asUndirected=function(){var g=new Graph;return this.eachNode(function(u,value){g.addNode(u,value)}),this.eachEdge(function(e,u,v,value){g.addEdge(e,u,v,value)}),g}},{"./Digraph":29,"./Graph":30}],46:[function(require,module,exports){exports.values=function(o){var i,ks=Object.keys(o),len=ks.length,result=new Array(len);for(i=0;len>i;++i)result[i]=o[ks[i]];return result}},{}],47:[function(require,module){module.exports="0.7.4"},{}]},{},[1]);var algo=algo||{};algo.render=algo.render||{},algo.render.Element=function(_options){var options=_.defaults(_.clone(_options||{}),{type:"Element",strokeWidth:1,fontSize:"40px"});algo.core.hasAny(options,"state","stroke","fill","pen")||(options.state=algo.render.kS_NORMAL),this.id="algoid-"+algo.render.Element.nextID++,algo.render.Element.map[this.id]=this,this.children=new algo.render.ElementGroup,this.addStates([{name:algo.render.kS_NORMAL,properties:{fill:algo.Color.iWHITE,stroke:algo.Color.iBLUE,pen:algo.Color.iBLUE}},{name:algo.render.kS_FADED,properties:{fill:algo.Color.iWHITE,stroke:algo.Color.iGRAY,pen:algo.Color.iGRAY}},{name:algo.render.kS_BLUE,properties:{fill:algo.Color.iBLUE,stroke:algo.Color.iBLUE,pen:algo.Color.iWHITE}},{name:algo.render.kS_GRAY,properties:{fill:algo.Color.iGRAY,stroke:algo.Color.iGRAY,pen:algo.Color.iWHITE}},{name:algo.render.kS_ORANGE,properties:{fill:algo.Color.iORANGE,stroke:algo.Color.iORANGE,pen:algo.Color.iWHITE}},{name:algo.render.kS_RED,properties:{fill:algo.Color.iRED,stroke:algo.Color.iRED,pen:algo.Color.iWHITE}},{name:algo.render.kS_GREEN,properties:{fill:algo.Color.iGREEN,stroke:algo.Color.iGREEN,pen:algo.Color.iWHITE}},{name:algo.render.kS_CYAN,properties:{fill:algo.Color.iCYAN,stroke:algo.Color.iCYAN,pen:algo.Color.iWHITE}}]),this.set(options)},algo.render.kS_NORMAL="ks_normal",algo.render.kS_FADED="ks_faded",algo.render.kS_BLUE="ks_blue",algo.render.kS_GRAY="ks_gray",algo.render.kS_ORANGE="ks_orange",algo.render.kS_RED="ks_red",algo.render.kS_GREEN="ks_green",algo.render.kS_CYAN="ks_cyan",algo.render.Element.prefixed=function(propertyName){if(!algo.render.Element.browserPrefix){var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1];algo.render.Element.browserPrefix={dom:dom,lowercase:pre,css:"-"+pre+"-",js:pre[0].toUpperCase()+pre.substr(1)}}return algo.render.Element.browserPrefix.css+propertyName},algo.render.Element.prototype.setState=function(stateName){this.states=this.states||{};var state;if(_.isArray(stateName)){var properties={};_.each(stateName,_.bind(function(name){if(state=this.states[name],!state)throw new Error("Attempt to apply unregistered state ( "+stateName+" ) to element:"+this.id);_.each(state.properties,_.bind(function(value,key){properties[key]=properties[key]||[],properties[key].push(value)},this)),this.set(properties)},this))}else{if(state=this.states[stateName],!state)throw new Error("Attempt to apply unregistered state ( "+stateName+" ) to element:"+this.id);this.set(state.properties)}},algo.render.Element.resetClass=function(){algo.render.Element.nextID=0,algo.render.Element.map={}},algo.render.Element.findElement=function(id){return algo.render.Element.map[id]},algo.render.Element.prototype.getInheritedValue=function(key,defaultValue){for(var obj=this;obj;){if(obj.hasOwnProperty(key))return obj[key];obj=obj.parent}return defaultValue},algo.render.Element.prototype.get=function(properties){var p=_.clone(properties);return _.each(p,function(defaultValue,key){p[key]=this.getInheritedValue(key,defaultValue)},this),p},algo.render.Element.prototype.set=function(options,_depth){var changes=0,depth=_depth||0;options&&(_.each(options,function(value,key){switch(key){case"parent":this.parent&&this.parent.removeChild(this),value.addChild(this),changes+=1;break;case"states":this.addStates(value);break;case"state":this.setState(value),changes+=1;break;case"shape":this.fromShape(value),changes+=1;break;default:this[key]!==value&&(this[key]=value,changes+=1)}},this),changes&&algo.SURFACE.elementUpdated(this,options),this.parent||options.parent||options.root||"algoid-0"===this.id||algo.SURFACE.root.addChild(this)),depth&&_.each(this.children.elements,function(child){child.set(options,depth-1)},this)},algo.render.Element.prototype.addStates=function(states){this.states=this.states||{},_.each(states,function(state){this.states[state.name]={properties:_.clone(state.properties)}},this)},algo.render.Element.set=function(options){for(var args=_.toArray(arguments),depth=_.isNumber(_.last(args))?args.pop():0,i=1;i<args.length;i+=1){var x=args[i];x instanceof algo.render.Element?x.set(options,depth):_.each(x,function(y){y instanceof algo.render.Element&&y.set(options,depth)},this)}},algo.render.Element.prototype.fromShape=function(){},algo.render.Element.prototype.getCSSColor=function(obj){var color=obj;return obj instanceof algo.Color||(color=new algo.Color(obj)),color.toCSS()},algo.render.Element.nextID=0,algo.render.Element.prototype.createDOM=function(){this.dom=$('<div class="algo-element algo-transition algo-element-fadein"><div class="algo-element-text algo-transition"></div></div>'),this.dom.attr("id",this.id),this.textSpan=$(".algo-element-text",this.dom),this.parent&&this.dom.appendTo(this.parent.dom)},algo.render.Element.prototype.updateDOM=function(){var prop={},tprop={};prop["background-color"]=this.getCSSColor(this.getInheritedValue("fill","transparent")),prop["background-image"]=this.getInheritedValue("gradient","none");var sw=this.getInheritedValue("strokeWidth",0);prop.border=sw?sw+"px solid "+this.getCSSColor(this.getInheritedValue("stroke","transparent")):"none",prop.opacity=this.getInheritedValue("opacity",1),prop.visibility=this.getInheritedValue("visible","visible"),prop["z-index"]=this.getInheritedValue("z",0),tprop.color=this.getCSSColor(this.getInheritedValue("pen","black")),tprop["font-size"]=this.getInheritedValue("fontSize","12px"),tprop["text-align"]=this.getInheritedValue("textAlign","center");var x=this.getInheritedValue("x",0),y=this.getInheritedValue("y",0),sx=this.getInheritedValue("scaleX",1),sy=this.getInheritedValue("scaleY",1),r=this.getInheritedValue("rotation",0),transform=algo.render.Element.prefixed("transform");prop[transform]="translate3d("+x+"px,"+y+"px,0) rotate("+r+"deg) scale("+sx+","+sy+")",this.dom.css(prop),this.textSpan.css(tprop),this.textSpan.text(this.text)},algo.render.Element.prototype.update=function(){this.dom||this.createDOM(),this.updateDOM(),_.each(this.children.elements,function(c){c.update()},this)},algo.render.Element.prototype.addChild=function(e){this.children.add(e),e.parent=this,e.parentID=this.id},algo.render.Element.prototype.removeChild=function(e){this.children.remove(e),delete e.parent,delete e.parentID},algo.render.Element.prototype.destroy=function(){if(this.destroyed)throw new Error("Destroy already called in Element::destroy");if(this.children.destroy(),this.parent&&this.parent.removeChild(this),this.dom&&(this.dom.remove(),delete this.dom),algo.SURFACE.elementDestroyed(this),!algo.render.Element.map[this.id])throw new Error("Missing Element");delete algo.render.Element.map[this.id],this.destroyed=!0},algo.render.Element.prototype.layout=function(box){this.set({x:box.cx,y:box.cy})},algo.render.Element.prototype.fillBox=function(box){this.set({x:box.x,y:box.y,w:box.w,h:box.h})},algo.render.Element.prototype.getBounds=function(){return new algo.layout.Box(this.x,this.y,0,0)},algo.render.Rectangle=function(_options){var options=_.clone(_options||{});algo.render.Element.call(this,_.defaults(options,{type:"Rectangle",cornerRadius:0}))},algo.core.extends(algo.render.Element,algo.render.Rectangle),algo.render.Rectangle.create=function(box,stroke,fill,strokeWidth){return new algo.render.Rectangle({shape:box,stroke:stroke,fill:fill,strokeWidth:strokeWidth})},algo.render.Rectangle.prototype.createDOM=function(){algo.render.Element.prototype.createDOM.call(this)},algo.render.Rectangle.prototype.updateDOM=function(){algo.render.Element.prototype.updateDOM.call(this);var w=this.getInheritedValue("w",0)>>0,h=this.getInheritedValue("h",0)>>0,cr=this.getInheritedValue("cornerRadius",0),prop={width:w,height:h,"border-radius":cr};this.dom.css(prop)},algo.render.Rectangle.prototype.layout=function(box){this.set({x:box.cx-this.w/2,y:box.cy-this.h/2})},algo.render.Rectangle.prototype.fromShape=function(shape){if(algo.core.isCircleLike(shape))this.x=shape.x-shape.radius,this.y=shape.y-shape.radius,this.w=2*shape.radius,this.h=2*shape.radius;else if(algo.core.isRectLike(shape))this.x=shape.x,this.y=shape.y,this.w=shape.w,this.h=shape.h;else{if(!algo.core.isPointLike(shape))throw new Error("algo.render.Rectangle.fromShape called with unrecognized shape");this.x=shape.x-this.w/2,this.y=shape.y-this.h/2}},algo.render.Rectangle.prototype.center=function(x,y){this.set({x:x-this.w/2,y:y-this.h/2})},algo.render.Rectangle.prototype.getBounds=function(){return new algo.layout.Box(this.x,this.y,this.w,this.h)},algo.render.LetterTile=function(_options){var options=_.clone(_options||{});algo.render.Rectangle.call(this,_.defaults(options,{type:"LetterTile",w:50,h:50,cornerRadius:0}))},algo.core.extends(algo.render.Rectangle,algo.render.LetterTile),algo.render.LetterTile.prototype.set=function(options,_depth){if(algo.render.Rectangle.prototype.set.call(this,options,_depth),algo.SURFACE.isWorker&&!this.valueElement&&(this.valueElement=new algo.render.Rectangle({x:0,y:0,w:0,h:0,parent:this,fill:algo.Color.iTRANSPARENT,strokeWidth:0,fontSize:16,textAlign:"right",text:""})),this.valueElement){var fontSize=12,inset=4;this.valueElement.set({y:inset,w:this.w-inset,h:fontSize,pen:this.pen,fontSize:fontSize+"px",text:this.value})}},algo.render.Circle=function(_options){var options=_.clone(_options||{});algo.render.Element.call(this,_.defaults(options,{type:"Circle"}))},algo.core.extends(algo.render.Element,algo.render.Circle),algo.render.Circle.prototype.fromShape=function(shape){if(algo.core.isCircleLike(shape))this.x=shape.x,this.y=shape.y,this.radius=shape.radius;else if(algo.core.isRectLike(shape))this.x=shape.x+shape.w/2,this.y=shape.y+shape.h/2,this.radius=Math.min(shape.w,shape.h)/2;else{if(!algo.core.isPointLike(shape))throw new Error("algo.render.Circle.fromShape called with unrecognized shape");this.x=shape.x,this.y=shape.y}},algo.render.Circle.prototype.createDOM=function(){algo.render.Element.prototype.createDOM.call(this)},algo.render.Circle.prototype.updateDOM=function(){algo.render.Element.prototype.updateDOM.call(this);var x=this.getInheritedValue("x",0),y=this.getInheritedValue("y",0),sx=this.getInheritedValue("scaleX",1),sy=this.getInheritedValue("scaleY",1),r=this.getInheritedValue("rotation",0),R=this.getInheritedValue("radius",10),sw=this.getInheritedValue("strokeWidth",0),o=-(R+sw),prop={width:2*R+"px",height:2*R+"px","border-radius":"100%"},transform="translate3d("+(x+o)+"px,"+(y+o)+"px,0) rotate("+r+"deg) scale("+sx+","+sy+")";prop[algo.render.Element.prefixed("transform")]=transform,prop.transform=transform,this.dom.css(prop)},algo.render.Circle.prototype.getBounds=function(){return new algo.layout.Box(this.x,this.y,2*this.R,2*this.R)},algo.render.Line=function(_options){var lineStates=[{name:algo.render.kS_NORMAL,properties:{fill:algo.Color.iBLUE}},{name:algo.render.kS_BLUE,properties:{fill:algo.Color.iBLUE}},{name:algo.render.kS_GRAY,properties:{fill:algo.Color.iGRAY}},{name:algo.render.kS_FADED,properties:{fill:algo.Color.iGRAY}},{name:algo.render.kS_ORANGE,properties:{fill:algo.Color.iORANGE}},{name:algo.render.kS_RED,properties:{fill:algo.Color.iRED}},{name:algo.render.kS_CYAN,properties:{fill:algo.Color.iCYAN}}],options=_.clone(_options||{});options.states=options.states?lineStates.concat(options.states):lineStates,algo.core.hasAny(options,"state","fill")||(options.state=algo.render.kS_NORMAL),algo.render.Element.call(this,_.defaults(options,{type:"Line",thickness:1,strokeWidth:0}))},algo.core.extends(algo.render.Element,algo.render.Line),algo.render.Line.prototype.createDOM=function(){algo.render.Element.prototype.createDOM.call(this)},algo.render.Line.prototype.updateDOM=function(){algo.render.Element.prototype.updateDOM.call(this);var p=this.get({x1:0,y1:0,x2:0,y2:0,thickness:1,strokeWidth:0,inset:0}),len=Math.sqrt((p.x2-p.x1)*(p.x2-p.x1)+(p.y2-p.y1)*(p.y2-p.y1));if(p.inset){p.inset=Math.min((len-4)/2,p.inset);var dx=p.x2-p.x1,dy=p.y2-p.y1,nx=dx/len||0,ny=dy/len||0,xi=nx*p.inset,yi=ny*p.inset;p.x1+=xi,p.y1+=yi,p.x2-=xi,p.y2-=yi}var rads=Math.atan2(p.y2-p.y1,p.x2-p.x1);0>rads&&(rads=2*Math.PI+rads),len=Math.sqrt((p.x2-p.x1)*(p.x2-p.x1)+(p.y2-p.y1)*(p.y2-p.y1));var t=p.thickness+2*p.strokeWidth,prop={width:len,height:p.thickness+"px","border-radius":t/2+"px"},origin="0px "+t/2+"px",transform="translate("+p.x1+"px,"+(p.y1-t/2)+"px) rotate("+rads+"rad)";prop[algo.render.Element.prefixed("transform-origin")]=origin,prop[algo.render.Element.prefixed("transform")]=transform,prop["transform-origin"]=origin,prop.transform=transform,this.dom.css(prop)},algo.render.Line.prototype.intersectWithLine=function(other){return algo.layout.Line.prototype.intersectWithLine.call(this,other).point},algo.render.Line.prototype.intersectWithBox=function(other){return algo.layout.Line.prototype.intersectWithBox.call(this,other).points},algo.render.Line.prototype.fromShape=function(shape){if(!algo.core.isLineLike(shape))throw new Error("Not line like shape in algo.render.Line::fromShape");this.x1=shape.x1,this.y1=shape.y1,this.x2=shape.x2,this.y2=shape.y2},algo.render.Arrow=function(options){algo.render.Line.call(this,_.defaults(options,{type:"Arrow",startArrow:!0,endArrow:!0}))},algo.core.extends(algo.render.Line,algo.render.Arrow),algo.render.Arrow.prototype.createDOM=function(){algo.render.Element.prototype.createDOM.call(this),this.startElement=$('<div class="algo-startarrow algo-transition"></div>'),this.startElement.appendTo(this.dom),this.endElement=$('<div class="algo-endarrow algo-transition"></div>'),this.endElement.appendTo(this.dom)},algo.render.Arrow.prototype.updateDOM=function(){algo.render.Line.prototype.updateDOM.call(this);var startCSS={display:"none"},endCSS={display:"none"};this.startArrow&&(startCSS={display:"block","border-right-color":this.getCSSColor(this.getInheritedValue("startArrowColor",this.getInheritedValue("fill",algo.Color.iBLUE)))}),this.endArrow&&(endCSS={display:"block","border-left-color":this.getCSSColor(this.getInheritedValue("endArrowColor",this.getInheritedValue("fill",algo.Color.iBLUE)))}),this.startElement.css(startCSS),this.endElement.css(endCSS)},algo.render.ElementGroup=function(){this.elements=[],_.each(_.toArray(arguments),function(arg){arg instanceof algo.render.Element?this.elements.push(arg):_.isArray(arg)?this.elements=_.union(this.elements,arg):_.isObject(arg)&&(this.elements=_.union(this.elements,_.values(arg)))},this)},algo.render.ElementGroup.prototype.set=function(options){_.each(this.elements,function(e){e.set(options)},this)},algo.render.ElementGroup.prototype.add=function(e){this.elements.indexOf(e)<0&&this.elements.push(e)},algo.render.ElementGroup.prototype.remove=function(e){var index=this.elements.indexOf(e);index>=0&&this.elements.splice(index,1)},algo.render.ElementGroup.prototype.clear=function(){this.elements.length=0},algo.render.ElementGroup.prototype.destroy=function(){_.each(_.toArray(this.elements),function(e){e.destroy()},this),this.elements.length=0};var algo=algo||{};algo.layout=algo.layout||{},algo.layout.Strategy=function(dataStructure){this.dataStructure=dataStructure},algo.layout.Strategy.prototype.update=function(){},algo.layout.GraphCircular=function(dataStructure){algo.layout.Strategy.call(this,dataStructure)},algo.core.extends(algo.layout.Strategy,algo.layout.GraphCircular),algo.layout.GraphCircular.prototype.update=function(box){var rX=box.w>>1,rY=box.h>>1,vertexPositions={},vertices=_.values(this.dataStructure.vertices);_.each(vertices,function(v,index){var degrees=index*(360/vertices.length),p=algo.core.pointOnEllipse(box.cx,box.cy,rX,rY,degrees);vertexPositions[v.id]=p,this.dataStructure.invoke("updateVertex",v,v.element,p,this.dataStructure)},this),_.each(this.dataStructure.edges,function(edge){var p1=vertexPositions[edge.source.id],p2=vertexPositions[edge.target.id];this.dataStructure.invoke("updateEdge",edge,edge.element,p1,p2,this.dataStructure)},this)},algo.layout.BinaryTree=function(dataStructure){algo.layout.Strategy.call(this,dataStructure)},algo.core.extends(algo.layout.Strategy,algo.layout.BinaryTree),algo.layout.BinaryTree.prototype.update=function(box){function traverseLayout(vertex,depth){vertex&&(maxDepth=Math.max(maxDepth,depth),traverseLayout(vertex.left,depth+1),vertexMap[vertex.id]={x:x++,y:depth},traverseLayout(vertex.right,depth+1))}var x=0,maxDepth=0,vertexMap={};traverseLayout(this.dataStructure.root,0);var p,b,grid=new algo.layout.GridLayout(box,maxDepth+1,x);_.each(this.dataStructure.vertices,function(v){p=vertexMap[v.id],b=grid.getBox(p.y,p.x),this.dataStructure.invoke("updateVertex",v,v.element,{x:b.cx,y:b.cy})},this),_.each(this.dataStructure.vertices,function(v){p=vertexMap[v.id],b=grid.getBox(p.y,p.x),v.left&&this.dataStructure.invoke("updateEdge",v.leftEdge,v.leftEdge.element,v,v.left),v.right&&this.dataStructure.invoke("updateEdge",v.rightEdge,v.rightEdge.element,v,v.right)},this)},algo.layout.GraphForceDirected=function(dataStructure,options){algo.layout.Strategy.call(this,dataStructure),this.graph=dataStructure,this.options=_.defaults(_.clone(options||{}),{stiffness:400,repulsion:400,damping:.5}),_.extend(this,this.options),this.vertexPoints={},this.edgeSprings={}},algo.core.extends(algo.layout.Strategy,algo.layout.GraphForceDirected),algo.layout.GraphForceDirected.prototype.update=function(box,ms){this.box=box;for(var stop=Date.now()+(ms||100);;)if(this.applyCoulombsLaw(),this.applyHookesLaw(),this.attractToCentre(),this.updateVelocity(.03),this.updatePosition(.03),this.totalEnergy()<.01||Date.now()>=stop)break;this.simBounds=this.getBoundingBox(),this.simSize=this.simBounds.topright.subtract(this.simBounds.bottomleft),_.each(this.graph.vertices,function(vertex){vertex.element&&this.graph.invoke("updateVertex",vertex,vertex.element,this.getVertexPosition(vertex))},this),_.each(this.graph.edges,function(edge){var spring=this.spring(edge),p1=this.simToScreen(spring.point1.p),p2=this.simToScreen(spring.point2.p);edge.element&&this.graph.invoke("updateEdge",edge,edge.element,p1,p2)},this)},algo.layout.GraphForceDirected.prototype.getVertexPosition=function(vertex){return this.simToScreen(this.vertexPoints[vertex.id].p)},algo.layout.GraphForceDirected.prototype.simToScreen=function(p){var sx=p.subtract(this.simBounds.bottomleft).divide(this.simSize.x).x*this.box.w,sy=p.subtract(this.simBounds.bottomleft).divide(this.simSize.y).y*this.box.h;return sx+=this.box.x,sy+=this.box.y,new algo.layout.Vector(sx,sy)},algo.layout.GraphForceDirected.prototype.point=function(vertex){if(!(vertex.id in this.vertexPoints)){var mass=vertex.mass||1;this.vertexPoints[vertex.id]=new algo.layout.GraphForceDirected.Point(algo.layout.Vector.random(),mass)}return this.vertexPoints[vertex.id]},algo.layout.GraphForceDirected.prototype.spring=function(edge){if(!(edge.id in this.edgeSprings)){var length=edge.length||1,existingSpring=!1,from=this.graph.getEdges(edge.source,edge.target);if(from.forEach(function(e){existingSpring===!1&&e.id in this.edgeSprings&&(existingSpring=this.edgeSprings[e.id])},this),existingSpring!==!1)return new algo.layout.GraphForceDirected.Spring(existingSpring.point1,existingSpring.point2,0,0);{this.graph.getEdges(edge.target,edge.source)}if(from.forEach(function(e){existingSpring===!1&&e.id in this.edgeSprings&&(existingSpring=this.edgeSprings[e.id])},this),existingSpring!==!1)return new algo.layout.GraphForceDirected.Spring(existingSpring.point2,existingSpring.point1,0,0);this.edgeSprings[edge.id]=new algo.layout.GraphForceDirected.Spring(this.point(edge.source),this.point(edge.target),length,this.stiffness)}return this.edgeSprings[edge.id]},algo.layout.GraphForceDirected.prototype.eachVertex=function(callback){var t=this;_.values(this.graph.vertices).forEach(function(n){callback.call(t,n,t.point(n))})},algo.layout.GraphForceDirected.prototype.eachEdge=function(callback){var t=this;_.values(this.graph.edges).forEach(function(e){callback.call(t,e,t.spring(e))})},algo.layout.GraphForceDirected.prototype.eachSpring=function(callback){var t=this;_.values(this.graph.edges).forEach(function(e){callback.call(t,t.spring(e))})},algo.layout.GraphForceDirected.prototype.applyCoulombsLaw=function(){this.eachVertex(function(n1,point1){this.eachVertex(function(n2,point2){if(point1!==point2){var d=point1.p.subtract(point2.p),distance=d.magnitude()+.1,direction=d.normalise();point1.applyForce(direction.multiply(this.repulsion).divide(distance*distance*.5)),point2.applyForce(direction.multiply(this.repulsion).divide(distance*distance*-.5))}})})},algo.layout.GraphForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(spring){var d=spring.point2.p.subtract(spring.point1.p),displacement=spring.length-d.magnitude(),direction=d.normalise();spring.point1.applyForce(direction.multiply(spring.k*displacement*-.5)),spring.point2.applyForce(direction.multiply(spring.k*displacement*.5))})},algo.layout.GraphForceDirected.prototype.attractToCentre=function(){this.eachVertex(function(vertex,point){var direction=point.p.multiply(-1);point.applyForce(direction.multiply(this.repulsion/50))})},algo.layout.GraphForceDirected.prototype.updateVelocity=function(timestep){this.eachVertex(function(vertex,point){point.v=point.v.add(point.a.multiply(timestep)).multiply(this.damping),point.a=new algo.layout.Vector(0,0)})},algo.layout.GraphForceDirected.prototype.updatePosition=function(timestep){this.eachVertex(function(vertex,point){point.p=point.p.add(point.v.multiply(timestep))})},algo.layout.GraphForceDirected.prototype.totalEnergy=function(){var energy=0;return this.eachVertex(function(vertex,point){var speed=point.v.magnitude();energy+=.5*point.m*speed*speed}),energy},algo.layout.GraphForceDirected.prototype.getBoundingBox=function(){var bottomleft=new algo.layout.Vector(-2,-2),topright=new algo.layout.Vector(2,2);return this.eachVertex(function(n,point){point.p.x<bottomleft.x&&(bottomleft.x=point.p.x),point.p.y<bottomleft.y&&(bottomleft.y=point.p.y),point.p.x>topright.x&&(topright.x=point.p.x),point.p.y>topright.y&&(topright.y=point.p.y)}),{bottomleft:bottomleft,topright:topright}},algo.layout.GraphForceDirected.Point=function(position,mass){this.p=position,this.m=mass,this.v=new algo.layout.Vector(0,0),this.a=new algo.layout.Vector(0,0)},algo.layout.GraphForceDirected.Point.prototype.applyForce=function(force){this.a=this.a.add(force.divide(this.m))},algo.layout.GraphForceDirected.Spring=function(point1,point2,length,k){this.point1=point1,this.point2=point2,this.length=length,this.k=k},algo.layout.Intersection=function(arg){arg instanceof algo.layout.Vector?this.points=[arg]:(_.isString(arg)&&(this.status=arg),this.points=[]),Object.defineProperty(this,"point",{enumerable:!0,get:function(){return this.points&&this.points.length>0?this.points[0]:null}}),Object.defineProperty(this,"status",{enumerable:!0,get:function(){return this._status},set:function(s){return this._status=s,this}})},algo.layout.Intersection.prototype.addPoint=function(p){return p&&(this.points=this.points||[],this.points.push(new algo.layout.Vector(p.x,p.y))),this},algo.layout.Vector=function(x,y){this.x=x,this.y=y},algo.layout.Vector.prototype.lerp=function(that,t){return new algo.layout.Vector(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t)},algo.layout.Vector.random=function(){return new algo.layout.Vector(Math.random()-.5,Math.random()-.5)},algo.layout.Vector.prototype.add=function(v2){return new algo.layout.Vector(this.x+v2.x,this.y+v2.y)},algo.layout.Vector.prototype.subtract=function(v2){return new algo.layout.Vector(this.x-v2.x,this.y-v2.y)},algo.layout.Vector.prototype.multiply=function(n){return new algo.layout.Vector(this.x*n,this.y*n)},algo.layout.Vector.prototype.divide=function(n){return new algo.layout.Vector(this.x/n||0,this.y/n||0)},algo.layout.Vector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},algo.layout.Vector.prototype.normal=function(){return new algo.layout.Vector(-this.y,this.x)},algo.layout.Vector.prototype.normalise=function(){return this.divide(this.magnitude())},algo.layout.Vector.prototype.clone=function(){return new algo.layout.Vector(this.x,this.y)},algo.layout.Vector.prototype.angle=function(other){var rads=Math.atan2(other.y-this.y,other.x-this.x);return 0>rads&&(rads=2*Math.PI+rads),algo.core.radiansToDegrees(rads)},algo.layout.Line=function(x1,y1,x2,y2){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2,Object.defineProperty(this,"dx",{enumerable:!0,get:function(){return this.x2-this.x1}}),Object.defineProperty(this,"dy",{enumerable:!0,get:function(){return this.y2-this.y1}}),Object.defineProperty(this,"length",{enumerable:!0,get:function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)}})},algo.layout.Line.topEdge=function(r){return new algo.layout.Line(r.x,r.y,r.x+r.w,r.y)},algo.layout.Line.bottomEdge=function(r){return new algo.layout.Line(r.x,r.y+r.h,r.x+r.w,r.y+r.h)},algo.layout.Line.leftEdge=function(r){return new algo.layout.Line(r.x,r.y,r.x,r.y+r.h)},algo.layout.Line.rightEdge=function(r){return new algo.layout.Line(r.x+r.w,r.y,r.x+r.w,r.y+r.h)},algo.layout.Line.getConnector=function(start,end){var p1,p2,temp;if(algo.core.isRectLike(start))p1=new algo.layout.Vector(start.x+start.w/2,start.y+start.h/2);else if(algo.core.isCircleLike(start))p1=new algo.layout.Vector(start.x,start.y);else{if(!algo.core.isPointLike(start))throw new Error("Unrecognized object passed to Line::getConnector");p1=new algo.layout.Vector(start.x,start.y)}if(algo.core.isRectLike(end))p2=new algo.layout.Vector(end.x+end.w/2,end.y+end.h/2);else if(algo.core.isCircleLike(end))p2=new algo.layout.Vector(end.x,end.y);else{if(!algo.core.isPointLike(end))throw new Error("Unrecognized object passed to Line::getConnector");p2=new algo.layout.Vector(end.x,end.y)}var line=new algo.layout.Line(p1.x,p1.y,p2.x,p2.y);return algo.core.isRectLike(start)?(temp=line.intersectWithBox(start),temp.point&&(line.x1=temp.point.x,line.y1=temp.point.y)):algo.core.isCircleLike(start)&&(temp=line.intersectWithCircle(start),temp.point&&(line.x1=temp.point.x,line.y1=temp.point.y)),algo.core.isRectLike(end)?(temp=line.intersectWithBox(end),temp.point&&(line.x2=temp.point.x,line.y2=temp.point.y)):algo.core.isCircleLike(end)&&(temp=line.intersectWithCircle(end),temp.point&&(line.x2=temp.point.x,line.y2=temp.point.y)),line},algo.layout.Line.prototype.intersectWithLine=function(other){var result,ua_t=(other.x2-other.x1)*(this.y1-other.y1)-(other.y2-other.y1)*(this.x1-other.x1),ub_t=(this.x2-this.x1)*(this.y1-other.y1)-(this.y2-this.y1)*(this.x1-other.x1),u_b=(other.y2-other.y1)*(this.x2-this.x1)-(other.x2-other.x1)*(this.y2-this.y1);if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b;ua>=0&&1>=ua&&ub>=0&&1>=ub?(result=new algo.layout.Intersection(new algo.layout.Vector(this.x1+ua*(this.x2-this.x1),this.y1+ua*(this.y2-this.y1))),result.status="Intersection"):result=new algo.layout.Intersection("No Intersection")
}else result=new algo.layout.Intersection(0===ua_t||0===ub_t?"Coincident":"Parallel");return result},algo.layout.Line.prototype.intersectWithBox=function(box){var result=new algo.layout.Intersection;return result.addPoint(this.intersectWithLine(algo.layout.Line.topEdge(box)).point),result.addPoint(this.intersectWithLine(algo.layout.Line.rightEdge(box)).point),result.addPoint(this.intersectWithLine(algo.layout.Line.bottomEdge(box)).point),result.addPoint(this.intersectWithLine(algo.layout.Line.leftEdge(box)).point),result.status=result.points?"Intersection":"No Intersection",result},algo.layout.Line.prototype.intersectWithCircle=function(c){var result,a1=new algo.layout.Vector(this.x1,this.y1),a2=new algo.layout.Vector(this.x2,this.y2),r=c.radius,a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y),b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y)),cc=c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r,deter=b*b-4*a*cc;if(0>deter)result=new algo.layout.Intersection("Outside");else if(0===deter)result=new algo.layout.Intersection("Tangent");else{var e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a);(0>u1||u1>1)&&(0>u2||u2>1)?result=new algo.layout.Intersection(0>u1&&0>u2||u1>1&&u2>1?"Outside":"Inside"):(result=new algo.layout.Intersection("Intersection"),u1>=0&&1>=u1&&result.points.push(a1.lerp(a2,u1)),u2>=0&&1>=u2&&result.points.push(a1.lerp(a2,u2)))}return result},algo.layout.Line.prototype.angleStartEnd=function(){var rads=Math.atan2(this.y2-this.y1,this.x2-this.x1);return 0>rads&&(rads=2*Math.PI+rads),rads},algo.layout.Circle=function(x,y,radius){this.x=x,this.y=y,this.radius=radius},algo.layout.Circle.prototype.clone=function(){return new algo.layout.Circle(this.x,this.y,this.radius)},algo.layout.Circle.prototype.inflate=function(delta){return new algo.layout.Circle(this.x,this.y,this.radius+delta)},algo.layout.Box=function(x,y,w,h){this.x=x||0,this.y=y||0,this.w=w||0,this.h=h||0,Object.defineProperty(this,"r",{enumerable:!0,get:function(){return this.x+this.w},set:function(_r){this.w=_r-this.x}}),Object.defineProperty(this,"b",{enumerable:!0,get:function(){return this.y+this.h},set:function(_b){this.h=_b-this.y}}),Object.defineProperty(this,"cx",{enumerable:!0,get:function(){return this.x+this.w/2},set:function(cx){this.x=cx-this.w/2}}),Object.defineProperty(this,"cy",{enumerable:!0,get:function(){return this.y+this.h/2},set:function(cy){this.y=cy-this.h/2}}),Object.defineProperty(this,"center",{enumerable:!0,get:function(){return new algo.layout.Vector(this.cx,this.cy)},set:function(v){this.cx=v.x,this.cy=v.y}})},algo.layout.Box.prototype.mul=function(v){return new algo.layout.Box(this.x*v.x,this.y*v.y,this.w*v.x,this.h*v.y)},algo.layout.Box.prototype.add=function(v){return new algo.layout.Box(this.x+v.x,this.y+v.y,this.w,this.h)},algo.layout.Box.prototype.clone=function(){return new algo.layout.Box(this.x,this.y,this.w,this.h)},algo.layout.Box.prototype.inflate=function(inflateX,inflateY){var b=new algo.layout.Box(this.x,this.y,this.w+2*inflateX,this.h+2*inflateY);return b.cx=this.cx,b.cy=this.cy,b},algo.layout.Box.prototype.isEmpty=function(){return this.w<=0||this.h<=0},algo.layout.Box.prototype.halign=function(other,alignment){switch(alignment){case"center":this.x=other.x+(other.w-this.w)/2;break;case"right":this.x=other.r-this.w;break;default:this.x=other.x}},algo.layout.Box.prototype.valign=function(other,alignment){switch(alignment){case"center":this.y=other.y+(other.h-this.h)/2;break;case"bottom":this.y=other.b-this.h;break;default:this.y=other.y}},algo.layout.Box.prototype.center=function(other){this.halign(other,"center"),this.valign(other,"center")},algo.layout.Box.prototype.union=function(box){var u=new algo.layout.Box(Math.min(this.x,box.x),Math.min(this.y,box.y),0,0);return u.r=Math.max(this.r,box.x+box.w),u.b=Math.max(this.b,box.y+box.h),u},algo.layout.Box.union=function(boxes){var u=new algo.layout.Box(0,0,0,0);return boxes&&boxes.length&&(u.x=_.min(boxes,function(box){return box.x}).x,u.y=_.min(boxes,function(box){return box.y}).y,u.r=_.max(boxes,function(box){return box.r}).r,u.b=_.max(boxes,function(box){return box.b}).b),u},algo.layout.Box.intersectWithBox=function(box){var minx=Math.min(this.r,box.r),maxx=Math.max(this.x,box.x),miny=Math.min(this.b,box.b),maxy=Math.max(this.y,box.y);if(minx>maxx&&miny>maxy){var x=Math.min(minx,maxx),y=Math.min(miny,maxy),w=Math.max(minx,maxx)-x,h=Math.max(miny,maxy)-y;return new algo.layout.Box(x,y,w,h)}return null},algo.layout.Box.prototype.pointSet=function(n,callback){for(var results=[],xgen=algo.core.randomFloat(this.x,this.r),ygen=algo.core.randomFloat(this.y,this.b),i=0;n>i;i+=1){var p=new algo.layout.Vector(xgen(),ygen());results.push(callback?callback(p.x,p.y):p)}return results},algo.layout.GridLayout=function(box,rows,columns,options){this.setBox(box),this.setRowsAndColumns(rows,columns),this.options=_.defaults(_.clone(options||{}),{inflateX:0,inflateY:0})},algo.layout.GridLayout.prototype.setBox=function(box){this.box=box.clone()},algo.layout.GridLayout.prototype.setRowsAndColumns=function(rows,columns){this.rows=rows,this.columns=columns},algo.layout.GridLayout.prototype.getBox=function(rowOrIndex,column){var r=1===arguments.length?Math.floor(rowOrIndex/this.columns):rowOrIndex,c=1===arguments.length?rowOrIndex%this.columns:column,cx=this.box.w/this.columns,cy=this.box.h/this.rows;return new algo.layout.Box(this.box.x+c*cx,this.box.y+r*cy,cx,cy).inflate(this.options.inflateX,this.options.inflateY)},algo.layout.GridLayout.prototype.getRowBox=function(row){return this.getBox(row,0).union(this.getBox(row,this.columns-1))},algo.layout.GridLayout.prototype.getColumnBox=function(col){return this.getBox(0,col).union(this.getBox(this.rows-1,col))},algo.layout.GridLayout.prototype.debugShow=function(){this.debugElements&&this.debugElements.destroy(),this.debugElements=this.debugElements||new algo.render.ElementGroup;for(var y=0;y<this.rows;y+=1)for(var x=0;x<this.columns;x+=1){var b=this.getBox(y,x),e=new algo.render.Rectangle({x:b.x,y:b.y,w:b.w,h:b.h,strokeWidth:1,stroke:"lightgray",fill:"transparent"});this.debugElements.add(e)}},algo.layout.HeapTree=function(dataStructure){algo.layout.Strategy.call(this,dataStructure),this.heap=this.dataStructure,this.edgeMap={}},algo.core.extends(algo.layout.Strategy,algo.layout.HeapTree),algo.layout.HeapTree.prototype.update=function(box){function traverseLayout(vertex,depth){this.heap.isNull(vertex)||(maxDepth=Math.max(maxDepth,depth),traverseLayout.call(this,this.heap.leftChild(vertex),depth+1),vertexMap[vertex]={x:x++,y:depth},traverseLayout.call(this,this.heap.rightChild(vertex),depth+1))}var x=0,maxDepth=0,vertexMap=[];traverseLayout.call(this,algo.core.Heap.kROOT,0);for(var grid=new algo.layout.GridLayout(box,maxDepth+1,x),newEdgeMap={},stack=[algo.core.Heap.kROOT];stack.length;){var current=stack.pop();if(!this.heap.isNull(current)){var p=vertexMap[current],b=grid.getBox(p.y,p.x),e=this.heap.element(current);e&&this.heap.invoke("updateVertex",this.heap.value(current),e,{x:b.cx,y:b.cy});var edge=this.edgeMap[current];if(!this.heap.isNull(this.heap.parent(current))){edge?(newEdgeMap[current]=edge,delete this.edgeMap[current]):edge=newEdgeMap[current]=this.heap.invoke("createEdge");var e1=this.heap.element(this.heap.parent(current)),e2=this.heap.element(current);this.heap.invoke("updateEdge",edge,e1,e2)}stack.push(this.heap.leftChild(current)),stack.push(this.heap.rightChild(current))}}_.each(this.edgeMap,_.bind(function(edge){this.heap.invoke("destroyEdge",edge)},this)),this.edgeMap=newEdgeMap},algo.layout.GraphDirected=function(dataStructure,options){algo.layout.Strategy.call(this,dataStructure),this.graph=dataStructure,_.extend(this,_.defaults(options||{},{vertexWidth:40,vertexHeight:40,nodeSeparation:15,edgeSeparation:15,rankSeparation:15,direction:"TB"}))},algo.layout.GraphDirected.prototype.update=function(box){var g=new dagre.Digraph;_.each(this.graph.vertices,_.bind(function(v){g.addNode(v.id,{label:v.id,width:this.vertexWidth,height:this.vertexHeight})},this)),_.each(this.graph.edges,_.bind(function(v){g.addEdge(v.id,v.source.id,v.target.id)},this));var layout=dagre.layout().nodeSep(this.nodeSeparation).edgeSep(this.edgeSeparation).rankSep(this.rankSeparation).rankDir(this.direction).run(g),graphSize=new algo.layout.Vector(layout.graph().width,layout.graph().height),S=new algo.layout.Vector(1,1),T=new algo.layout.Vector(0,0);graphSize.x>box.w?S.x=box.w/graphSize.x:T.x=(box.w-graphSize.x)/2,graphSize.y>box.h?S.y=box.h/graphSize.y:T.y=(box.h-graphSize.y)/2,T=T.add(new algo.layout.Vector(box.x,box.y));var vertexBoxes={};layout.eachNode(_.bind(function(nodeName,node){var b=new algo.layout.Box(node.x-(node.width>>1),node.y-(node.height>>1),node.width,node.height);b=b.mul(S).add(T),vertexBoxes[nodeName]=b;var v=this.graph.vertices[nodeName];v.element&&this.dataStructure.invoke("updateVertex",v,v.element,b,this.graph)},this)),layout.eachEdge(_.bind(function(e,u,v,value){var start=vertexBoxes[u].center,end=vertexBoxes[v].center,middle=new algo.layout.Vector(value.points[0].x,value.points[0].y).multiply(S).add(T),edge=this.graph.edges[e];edge.element&&this.dataStructure.invoke("updateEdge",edge,edge.element,start,middle,end,this.graph)},this))};var algo=algo||{};algo.render=algo.render||{},algo.SURFACE=null,algo.render.Surface=function(options){algo.SURFACE=this,algo.render.Element.resetClass(),this.options=options,this.isDOM?(this.dom=options.domSelector,this.commandHandlers={},this.commandHandlers[algo.render.Surface.UPDATE_COMMAND]=this.handleUpdateCommand,this.commandHandlers[algo.render.Surface.DESTROY_COMMAND]=this.handleDestroyCommand):(this.commands=[],this.root=algo.ROOT=new algo.render.Rectangle({root:!0,visible:!1,x:options.bounds.x,y:options.bounds.y,w:options.bounds.w,h:options.bounds.h,strokeWidth:0}),algo.BOUNDS=this.root.getBounds())},algo.render.Surface.prototype.__defineGetter__("isWorker",function(){return this.options.location===algo.render.Surface.WORKER}),algo.render.Surface.prototype.__defineGetter__("isDOM",function(){return this.options.location===algo.render.Surface.DOM}),algo.render.Surface.WORKER="worker",algo.render.Surface.DOM="dom",algo.render.Surface.UPDATE_COMMAND="updateElement",algo.render.Surface.DESTROY_COMMAND="destroyElement",algo.render.Surface.prototype.elementDestroyed=function(element){this.addCommand(algo.render.Surface.DESTROY_COMMAND,element,{})},algo.render.Surface.prototype.elementUpdated=function(element,options){this.addCommand(algo.render.Surface.UPDATE_COMMAND,element,options)},algo.render.Surface.prototype.addCommand=function(name,element,options){if(!this.isDOM){var c=_.omit(options,"states","state");if(options.parent&&(c.parent=options.parent.id),c.id=element.id,name===algo.render.Surface.UPDATE_COMMAND){var existingCommand=_.find(this.commands,function(command){return command.name===algo.render.Surface.UPDATE_COMMAND&&command.options.id===c.id},this);if(existingCommand)return void _.extend(existingCommand.options,c)}this.commands.push({name:name,options:c})}},algo.render.Surface.prototype.flushCommands=function(){var buffer=this.commands.slice();return this.commands.length=0,buffer},algo.render.Surface.prototype.executeCommands=function(commands){_.each(commands,function(command){var params=command.options;params.parent&&(params.parent=algo.render.Element.findElement(params.parent)),this.commandHandlers[command.name].call(this,command.options)},this),this.update(),this.validate()},algo.render.Surface.prototype.handleUpdateCommand=function(options){var e=algo.render.Element.findElement(options.id);if(!e&&(e=new algo.render[options.type](options),options.root&&(this.root=algo.ROOT=e),e.id!==options.id))throw new Error("Element ID mismatch");e.set(options)},algo.render.Surface.prototype.processOptions=function(options){options.more=!1;var clone={};return _.each(options,function(value,key){_.isArray(value)?(clone[key]=value.shift(),0===value.length?delete options[key]:options.more=!0):clone[key]=value},this),clone},algo.render.Surface.prototype.handleDestroyCommand=function(options){algo.render.Element.findElement(options.id).destroy()},algo.render.Surface.prototype.update=function(){this.root.update(),0===this.root.dom.parent().length&&this.root.dom.appendTo(this.dom)},algo.render.Surface.prototype.validate=function(){if(this.isDOM&&!algo.G.live){var elements=$(".algo-element",this.root.element);if(_.each(elements,function(element){var e=$(element),id=e.attr("id");if(!algo.render.Element.map[id])throw new Error("Element in root not found in element map")},this),_.each(algo.render.Element.map,function(element){var id=element.id,d=$("#"+id);if(1!==d.length)throw new Error("Element in map not found in DOM")},this),elements.length!==_.keys(algo.render.Element.map).length)throw new Error("Mismatch between length of static map and elements in root")}};var globalScope=this;self.onmessage=function(event){switch(event.data.name){case"M_Initialize":new WorkerApp(this,event.data.algorithmURI,event.data.api);break;case"M_Continue":WorkerApp.I.pauseOrContinue()}};var WorkerApp=function(worker,algorithmURI,api){this.worker=worker,WorkerApp.I=this,globalScope.algo||importScripts("/javascripts/underscore.js","/javascripts/underscore-string.js","/javascripts/regenerator-runtime.js","/javascripts/apis/"+api+"/core.js","/javascripts/apis/"+api+"/color.js","/javascripts/apis/"+api+"/layout.js","/javascripts/apis/"+api+"/element.js","/javascripts/apis/"+api+"/surface.js","/javascripts/apis/"+api+"/dagre.js"),_.mixin(_.str.exports()),this.surface=new algo.render.Surface({location:algo.render.Surface.WORKER,bounds:new algo.layout.Box(0,0,900,556)}),importScripts(algorithmURI),this.worker.postMessage({name:"M_Initialize_ACK"}),this.userAlgorithm=algorithm(),this.continue()};WorkerApp.prototype.continue=function(){var y;try{y=this.userAlgorithm.next()}catch(error){return this.worker.postMessage({name:"M_Exception",message:error.message,stack:error.stack}),void this.done()}y.done?this.done():this.pause(y.value)},WorkerApp.prototype.pause=function(pauseParameters){this.currentCommands=this.surface.flushCommands();var activeCommands=[];_.each(this.currentCommands,function(command){activeCommands.push("updateElement"===command.name?{name:command.name,options:this.surface.processOptions(command.options)}:command)},this),this.worker.postMessage({name:"M_Pause",renderCommands:activeCommands,options:pauseParameters})},WorkerApp.prototype.pauseOrContinue=function(){var activeCommands=[];_.each(this.currentCommands,function(command){"updateElement"===command.name&&command.options.more&&activeCommands.push({name:command.name,options:this.surface.processOptions(command.options)})},this),activeCommands.length?this.worker.postMessage({name:"M_Pause",renderCommands:activeCommands,options:{autoskip:!0}}):this.continue()},WorkerApp.prototype.done=function(){this.worker.postMessage({name:"M_Done",renderCommands:this.surface.flushCommands()})};